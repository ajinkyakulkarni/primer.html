<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Introduction to classes in Python">
<meta name="keywords" content="constructor (class),UML class diagram,instance (class),user-defined datatype (class),method class),attribute (class),new-style classes,namespace,closures,test function,nose tests,pytest tests,special methods (class),callable objects,test function,closure,Newton's method,SymPy differentiation,closure,wrapper code,integration numerical,symbolic computing,integration symbolic,SymPy integration,mutable objects,immutable objects,protected attributes (class),test function,information hiding,private attributes (class),API,application programming interface,protected attributes (class),check an object's type,static typing,weak typing,strong typing,dynamic typing,duck typing,static class attributes,static class variables,static class methods,interval arithmetic">

<title>Introduction to classes in Python</title>

<!-- Bootstrap style: bootstrap_simula -->
<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_bootstrap/css/bootstrap_simula.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}

/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px; /* fixed header height*/
  margin:-50px 0 0; /* negative fixed header height */
}

body { font-size:20px;line-height:1.5; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Table of contents',
               1,
               'table_of_contents',
               'table_of_contents'),
              ('Simple function classes',
               1,
               'sec:class:functors',
               'sec:class:functors'),
              ('Challenge: functions with parameters',
               2,
               'sec:class:func1',
               'sec:class:func1'),
              ('Problem', 3, None, '___sec2'),
              ('A bad solution: global variables', 3, None, '___sec3'),
              ('Representing a function as a class',
               2,
               'sec:class:func2',
               'sec:class:func2'),
              ('Implementation', 3, None, '___sec5'),
              ('Usage and dissection', 3, None, '___sec6'),
              ('Extension of the class', 3, None, '___sec7'),
              ('Using methods as ordinary functions', 3, None, '___sec8'),
              ('New-style classes versus classic classes',
               3,
               None,
               '___sec9'),
              ('Doc strings', 3, None, '___sec10'),
              ('The self variable', 2, None, '___sec11'),
              ('Another function class example',
               2,
               'sec:class:func3',
               'sec:class:func3'),
              ('Remark', 3, None, '___sec13'),
              ('Alternative function class implementations',
               2,
               'sec:class:func2b',
               'sec:class:func2b'),
              ('Making classes without the class construct',
               2,
               'sec:class:whatis',
               'sec:class:whatis'),
              ('First remark', 3, None, '___sec16'),
              ('Second remark', 3, None, '___sec17'),
              ('Closures', 2, 'sec:class:closure', 'sec:class:closure'),
              ('More examples on classes',
               1,
               'sec:class:addex',
               'sec:class:addex'),
              ('Bank accounts', 2, 'sec:class:account', 'sec:class:account'),
              ('Phone book', 2, 'sec:class:phonebook', 'sec:class:phonebook'),
              ('A circle', 2, 'sec:class:circle', 'sec:class:circle'),
              ('Verification', 3, None, '___sec23'),
              ('Remark', 3, None, '___sec24'),
              ('Special methods',
               1,
               'sec:class:specialmethods',
               'sec:class:specialmethods'),
              ('The call special method',
               2,
               'sec:class:call',
               'sec:class:call'),
              ('Example: Automagic differentiation',
               2,
               'sec:class:autodF',
               'sec:class:autodF'),
              ('Problem', 3, None, '___sec28'),
              ('Solution', 3, None, '___sec29'),
              ('Verification', 3, None, '___sec30'),
              ("Application: Newton's method", 3, None, '___sec31'),
              ('Solution utilizing SymPy', 3, None, '___sec32'),
              ('Example: Automagic integration',
               2,
               'sec:class:autoint',
               'sec:class:autoint'),
              ('A simple implementation', 3, None, '___sec34'),
              ('Verification via symbolic computing', 3, None, '___sec35'),
              ('Remark', 3, None, '___sec36'),
              ('Turning an instance into a string',
               2,
               'sec:class:str',
               'sec:class:str'),
              ('Example: Phone book with special methods',
               2,
               'sec:class:phonebook2',
               'sec:class:phonebook2'),
              ('Remark', 3, None, '___sec39'),
              ('Adding objects', 2, 'sec:class:add', 'sec:class:add'),
              ('Example: Class for polynomials',
               2,
               'sec:class:Polynomial',
               'sec:class:Polynomial'),
              ('Implementation', 3, None, '___sec42'),
              ('Usage', 3, None, '___sec43'),
              ('Pretty print of polynomials', 3, None, '___sec44'),
              ('Verifying the implementation', 3, None, '___sec45'),
              ('Arithmetic operations and other special methods',
               2,
               'sec:class:arithmetics',
               'sec:class:arithmetics'),
              ('Special methods for string conversion',
               2,
               'sec:class:repr',
               'sec:class:repr'),
              ('Recreating objects from strings', 3, None, '___sec48'),
              ('Example: Class for vectors in the plane',
               1,
               'sec:class:Vec2D',
               'sec:class:Vec2D'),
              ('Some mathematical operations on vectors',
               2,
               None,
               '___sec50'),
              ('Implementation', 2, None, '___sec51'),
              ('Usage', 2, None, '___sec52'),
              ('Comment', 3, None, '___sec53'),
              ('Example: Class for complex numbers', 1, None, '___sec54'),
              ('Implementation', 2, 'sec:class:Complex', 'sec:class:Complex'),
              ('Illegal operations',
               2,
               'sec:class:illegalop',
               'sec:class:illegalop'),
              ('Mixing complex and real numbers',
               2,
               'sec:class:complex:mixed',
               'sec:class:complex:mixed'),
              ('Dynamic, static, strong, weak, and duck typing',
               2,
               None,
               '___sec58'),
              ("Special methods for ``right'' operands",
               2,
               'sec:class:complex:rightop',
               'sec:class:complex:rightop'),
              ('Remark', 3, None, '___sec60'),
              ('Inspecting instances',
               2,
               'sec:class:inspect',
               'sec:class:inspect'),
              ('Static methods and attributes',
               1,
               'sec:class:static',
               'sec:class:static'),
              ('Summary', 1, None, '___sec63'),
              ('Chapter topics', 2, 'sec:class:summary', 'sec:class:summary'),
              ('Classes', 3, None, '___sec65'),
              ('Special methods', 3, None, '___sec66'),
              ('Terminology', 3, None, '___sec67'),
              ('Example: interval arithmetic',
               2,
               'sec:class:interval:arithmetic',
               'sec:class:interval:arithmetic'),
              ('Problem', 3, None, '___sec69'),
              ('Solution', 3, None, '___sec70'),
              ('Exercises', 1, None, '___sec71'),
              ('Exercise 1: Make a function class',
               2,
               'sec:class:ex2',
               'sec:class:ex2'),
              ('Exercise 2: Add a data attribute to a class',
               2,
               'sec:class:ex25q',
               'sec:class:ex25q'),
              ('Exercise 3: Add functionality to a class',
               2,
               'sec:class:ex25q2',
               'sec:class:ex25q2'),
              ('Remarks', 3, None, '___sec75'),
              ('Exercise 4: Make classes for a rectangle and a triangle',
               2,
               'sec:class:ex23',
               'sec:class:ex23'),
              ('Exercise 5: Make a class for quadratic functions',
               2,
               'sec:class:ex11',
               'sec:class:ex11'),
              ('Exercise 6: Make a class for straight lines',
               2,
               'sec:class:ex25',
               'sec:class:ex25'),
              ('Exercise 7: Flexible handling of function arguments',
               2,
               'sec:class:ex25b',
               'sec:class:ex25b'),
              ('Exercise 8: Wrap functions in a class',
               2,
               'sec:class:ex27d',
               'sec:class:ex27d'),
              ('Exercise 9: Flexible handling of function arguments',
               2,
               'sec:class:ex27e',
               'sec:class:ex27e'),
              ('Exercise 10: Deduce a class implementation',
               2,
               'sec:class:ex1',
               'sec:class:ex1'),
              ('Exercise 11: Implement special methods in a class',
               2,
               'sec:class:ex2b2',
               'sec:class:ex2b2'),
              ('Exercise 12: Make a class for summation of series',
               2,
               'sec:class:ex2b',
               'sec:class:ex2b'),
              ('Exercise 13: Apply a numerical differentiation class',
               2,
               'sec:class:ex10',
               'sec:class:ex10'),
              ('Exercise 14: Implement an addition operator',
               2,
               'sec:class:ex:tribesman',
               'sec:class:ex:tribesman'),
              ('Exercise 15: Implement in-place `+=` and `-=` operators',
               2,
               'sec:class:ex25qb',
               'sec:class:ex25qb'),
              ('Exercise 16: Implement a class for numerical differentiation',
               2,
               'sec:class:ex21',
               'sec:class:ex21'),
              ('Exercise 17: Examine a program',
               2,
               'sec:class:ex21b',
               'sec:class:ex21b'),
              ('Exercise 18: Modify a class for numerical differentiation',
               2,
               'sec:class:ex23s',
               'sec:class:ex23s'),
              ('Exercise 19: Make a class for the Heaviside function',
               2,
               'sec:basic:exHclass',
               'sec:basic:exHclass'),
              ('Exercise 20: Make a class for the indicator function',
               2,
               'sec:basic:exIndclass',
               'sec:basic:exIndclass'),
              ('Exercise 21: Make a class for piecewise constant functions',
               2,
               'sec:basic:ex:piecewisefunc',
               'sec:basic:ex:piecewisefunc'),
              ('Exercise 22: Speed up repeated integral calculations',
               2,
               'sec:class:ex13c',
               'sec:class:ex13c'),
              ('Exercise 23: Apply a class for polynomials',
               2,
               'sec:class:ex5',
               'sec:class:ex5'),
              ('Exercise 24: Find a bug in a class for polynomials',
               2,
               'sec:class:ex4',
               'sec:class:ex4'),
              ('Exercise 25: Implement subtraction of polynomials',
               2,
               'sec:class:ex6a',
               'sec:class:ex6a'),
              ('Exercise 26: Test the functionality of pretty print of polynomials',
               2,
               'sec:class:exer:str',
               'sec:class:exer:str'),
              ('Exercise 27: Vectorize a class for polynomials',
               2,
               'sec:class:ex7v',
               'sec:class:ex7v'),
              ('Remarks', 3, None, '___sec100'),
              ('Exercise 28: Use a dict to hold polynomial coefficients',
               2,
               'sec:class:ex8',
               'sec:class:ex8'),
              ('Exercise 29: Extend class Vec2D to work with lists/tuples',
               2,
               'sec:class:ex16',
               'sec:class:ex16'),
              ('Exercise 30: Extend class Vec2D to 3D vectors',
               2,
               'sec:class:ex17b',
               'sec:class:ex17b'),
              ('Exercise 31: Use NumPy arrays in class Vec2D',
               2,
               'sec:class:ex17',
               'sec:class:ex17'),
              ('Exercise 32: Impreciseness of interval arithmetics',
               2,
               None,
               '___sec105'),
              ('Remarks', 3, None, '___sec106'),
              ('Exercise 33: Make classes for students and courses',
               2,
               'sec:class:ex15',
               'sec:class:ex15'),
              ('Exercise 34: Find local and global extrema of a function',
               2,
               'sec:plot:ex28',
               'sec:plot:ex28'),
              ('Exercise 35: Find the optimal production for a company',
               2,
               'sec:class:ex18a',
               'sec:class:ex18a'),
              ('References', 1, None, '___sec110')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\tp}{\thinspace .}
$$




    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="class-bootstrap.html">Introduction to classes in Python</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._class-bootstrap000.html#table_of_contents" style="font-size: 80%;"><b>Table of contents</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:functors" style="font-size: 80%;"><b>Simple function classes</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:func1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Challenge: functions with parameters</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Problem</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec3" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A bad solution: global variables</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:func2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Representing a function as a class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec5" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec6" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage and dissection</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec7" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Extension of the class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec8" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Using methods as ordinary functions</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec9" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;New-style classes versus classic classes</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec10" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Doc strings</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec11" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The self variable</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:func3" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Another function class example</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec13" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:func2b" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Alternative function class implementations</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:whatis" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Making classes without the class construct</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec16" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;First remark</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#___sec17" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Second remark</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap001.html#sec:class:closure" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Closures</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap002.html#sec:class:addex" style="font-size: 80%;"><b>More examples on classes</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap002.html#sec:class:account" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Bank accounts</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap002.html#sec:class:phonebook" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Phone book</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap002.html#sec:class:circle" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A circle</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap002.html#___sec23" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verification</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap002.html#___sec24" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:specialmethods" style="font-size: 80%;"><b>Special methods</b></a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:call" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The call special method</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:autodF" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Example: Automagic differentiation</a></li>
     <!-- navigation toc: --> <li><a href="#___sec28" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Problem</a></li>
     <!-- navigation toc: --> <li><a href="#___sec29" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solution</a></li>
     <!-- navigation toc: --> <li><a href="#___sec30" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verification</a></li>
     <!-- navigation toc: --> <li><a href="#___sec31" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application: Newton's method</a></li>
     <!-- navigation toc: --> <li><a href="#___sec32" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solution utilizing SymPy</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:autoint" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Example: Automagic integration</a></li>
     <!-- navigation toc: --> <li><a href="#___sec34" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A simple implementation</a></li>
     <!-- navigation toc: --> <li><a href="#___sec35" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verification via symbolic computing</a></li>
     <!-- navigation toc: --> <li><a href="#___sec36" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:str" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Turning an instance into a string</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:phonebook2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Example: Phone book with special methods</a></li>
     <!-- navigation toc: --> <li><a href="#___sec39" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:add" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Adding objects</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:Polynomial" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Example: Class for polynomials</a></li>
     <!-- navigation toc: --> <li><a href="#___sec42" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="#___sec43" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage</a></li>
     <!-- navigation toc: --> <li><a href="#___sec44" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pretty print of polynomials</a></li>
     <!-- navigation toc: --> <li><a href="#___sec45" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verifying the implementation</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:arithmetics" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Arithmetic operations and other special methods</a></li>
     <!-- navigation toc: --> <li><a href="#sec:class:repr" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Special methods for string conversion</a></li>
     <!-- navigation toc: --> <li><a href="#___sec48" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recreating objects from strings</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap004.html#sec:class:Vec2D" style="font-size: 80%;"><b>Example: Class for vectors in the plane</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap004.html#___sec50" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Some mathematical operations on vectors</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap004.html#___sec51" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap004.html#___sec52" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Usage</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap004.html#___sec53" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comment</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#___sec54" style="font-size: 80%;"><b>Example: Class for complex numbers</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#sec:class:Complex" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Implementation</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#sec:class:illegalop" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Illegal operations</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#sec:class:complex:mixed" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Mixing complex and real numbers</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#___sec58" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Dynamic, static, strong, weak, and duck typing</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#sec:class:complex:rightop" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Special methods for ``right'' operands</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#___sec60" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remark</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap005.html#sec:class:inspect" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Inspecting instances</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap006.html#sec:class:static" style="font-size: 80%;"><b>Static methods and attributes</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#___sec63" style="font-size: 80%;"><b>Summary</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#sec:class:summary" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Chapter topics</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#___sec65" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Classes</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#___sec66" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Special methods</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#___sec67" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Terminology</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#sec:class:interval:arithmetic" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Example: interval arithmetic</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#___sec69" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Problem</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap007.html#___sec70" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solution</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#___sec71" style="font-size: 80%;"><b>Exercises</b></a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 1: Make a function class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex25q" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 2: Add a data attribute to a class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex25q2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 3: Add functionality to a class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#___sec75" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex23" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 4: Make classes for a rectangle and a triangle</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex11" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 5: Make a class for quadratic functions</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex25" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 6: Make a class for straight lines</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex25b" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 7: Flexible handling of function arguments</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex27d" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 8: Wrap functions in a class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex27e" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 9: Flexible handling of function arguments</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 10: Deduce a class implementation</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex2b2" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 11: Implement special methods in a class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex2b" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 12: Make a class for summation of series</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex10" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 13: Apply a numerical differentiation class</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex:tribesman" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 14: Implement an addition operator</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex25qb" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 15: Implement in-place <code>+=</code> and <code>-=</code> operators</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex21" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 16: Implement a class for numerical differentiation</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex21b" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 17: Examine a program</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex23s" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 18: Modify a class for numerical differentiation</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:basic:exHclass" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 19: Make a class for the Heaviside function</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:basic:exIndclass" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 20: Make a class for the indicator function</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:basic:ex:piecewisefunc" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 21: Make a class for piecewise constant functions</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex13c" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 22: Speed up repeated integral calculations</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex5" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 23: Apply a class for polynomials</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex4" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 24: Find a bug in a class for polynomials</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex6a" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 25: Implement subtraction of polynomials</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:exer:str" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 26: Test the functionality of pretty print of polynomials</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex7v" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 27: Vectorize a class for polynomials</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#___sec100" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex8" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 28: Use a dict to hold polynomial coefficients</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex16" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 29: Extend class Vec2D to work with lists/tuples</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex17b" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 30: Extend class Vec2D to 3D vectors</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex17" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 31: Use NumPy arrays in class Vec2D</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#___sec105" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 32: Impreciseness of interval arithmetics</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#___sec106" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remarks</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex15" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 33: Make classes for students and courses</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:plot:ex28" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 34: Find local and global extrema of a function</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#sec:class:ex18a" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 35: Find the optimal production for a company</a></li>
     <!-- navigation toc: --> <li><a href="._class-bootstrap008.html#___sec110" style="font-size: 80%;"><b>References</b></a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0003"></a>
<!-- !split -->
<p style="font-size:80%">This chapter is taken from the book <a href="http://www.springer.com/gp/book/9783662498866">A Primer on Scientific Programming with Python</a> by H. P. Langtangen, 5th edition, Springer, 2016.</p>

<h1 id="sec:class:specialmethods" class="anchor">Special methods</h1>

<p>
Some class methods have names starting and ending with a double
underscore.  These methods allow a special syntax in the program and
are called <em>special methods</em>.  The constructor <code>__init__</code> is one
example. This method is automatically called when an instance is
created (by calling the class as a function), but we do not need to
explicitly write <code>__init__</code>.  Other special methods make it possible
to perform arithmetic operations with instances, to compare instances
with <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>, etc., to call instances as we call ordinary
functions, and to test if an instance evaluates to <code>True</code> or <code>False</code>,
to mention some possibilities.

<h2 id="sec:class:call" class="anchor">The call special method</h2>

<p>
Computing the value of the mathematical function represented by class
<code>Y</code> from the section <a href="._class-bootstrap001.html#sec:class:func2">Representing a function as a class</a>, with <code>y</code> as the name of the
instance, is performed by writing <code>y.value(t)</code>.  If we could write
just <code>y(t)</code>, the <code>y</code> instance would look as an ordinary function. Such
a syntax is indeed possible and offered by the special method named
<code>__call__</code>. Writing <code>y(t)</code> implies a call

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>y<span style="color: #666666">.</span>__call__(t)
</pre></div>
<p>
if class <code>Y</code> has the method <code>__call__</code> defined.
We may easily add this special method:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Y</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, t):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>v0<span style="color: #666666">*</span>t <span style="color: #666666">-</span> <span style="color: #666666">0.5*</span><span style="color: #008000">self</span><span style="color: #666666">.</span>g<span style="color: #666666">*</span>t<span style="color: #666666">**2</span>
</pre></div>
<p>
The previous <code>value</code> method is now redundant.  A good programming
convention is to include a <code>__call__</code> method in all classes that
represent a mathematical function.  Instances with <code>__call__</code> methods
are said to be <em>callable</em> objects, just as plain functions are
callable objects as well. The call syntax for callable objects is the
same, regardless of whether the object is a function or a class
instance.  Given an object <code>a</code>,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(a):
</pre></div>
<p>
tests whether <code>a</code> behaves as a callable, i.e., if <code>a</code>
is a Python function or an instance with a <code>__call__</code>
method.
<!-- isinstance(a, collections.Callable) for v3.0 and 3.1, but -->
<!-- callable is back in 3.2 -->

<p>
In particular, an instance of class <code>Y</code> can be passed as the
<code>f</code> argument to the <code>diff</code> function from the section <a href="._class-bootstrap001.html#sec:class:func1">Challenge: functions with parameters</a>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>y <span style="color: #666666">=</span> Y(v0<span style="color: #666666">=5</span>)
dydt <span style="color: #666666">=</span> diff(y, <span style="color: #666666">0.1</span>)
</pre></div>
<p>
Inside <code>diff</code>, we can test that <code>f</code> is not a function but an
instance of class <code>Y</code>. However, we only use <code>f</code> in calls, like
<code>f(x)</code>, and for this purpose an instance with a
<code>__call__</code> method works as a plain function.
This feature is very convenient.

<p>
The next section demonstrates a neat application of the call
operator <code>__call__</code> in a numerical algorithm.

<h2 id="sec:class:autodF" class="anchor">Example: Automagic differentiation</h2>

<h3 id="___sec28" class="anchor">Problem </h3>

<p>
Given a Python implementation <code>f(x)</code> of a mathematical function
\( f(x) \), we want to create an object that behaves as a Python function
for computing the derivative \( f'(x) \). For example, if this object is
of type <code>Derivative</code>, we should be able to write something like

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(x):
        <span style="color: #008000; font-weight: bold">return</span> x<span style="color: #666666">**3</span>
<span style="color: #666666">...</span>
<span style="color: #666666">&gt;&gt;&gt;</span> dfdx <span style="color: #666666">=</span> Derivative(f)
<span style="color: #666666">&gt;&gt;&gt;</span> x <span style="color: #666666">=</span> <span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> dfdx(x)
<span style="color: #666666">12.000000992884452</span>
</pre></div>
<p>
That is, <code>dfdx</code> behaves as a straight Python function for implementing
the derivative \( 3x^2 \) of \( x^3 \) (well, the answer is only approximate,
with an error in the 7th decimal,
but the approximation can easily be improved).

<p>
Maple, Mathematica, and many other software packages can do exact
symbolic mathematics, including differentiation and integration.  The
Python package <code>sympy</code> for symbolic mathematics
makes it trivial to calculate the exact derivative of
a large class of functions \( f(x) \) and turn the result into
an ordinary Python function. However, mathematical functions that are defined
in an algorithmic way (e.g., solution of another mathematical
problem), or functions with branches, random numbers, etc., pose
fundamental problems to symbolic differentiation, and then numerical
differentiation is required. Therefore we base the computation of
derivatives in <code>Derivative</code> instances on finite difference
formulas. Use of exact symbolic differentiation via SymPy is also possible.

<h3 id="___sec29" class="anchor">Solution </h3>

<p>
The most basic (but not the best) formula for a numerical derivative is

$$
\begin{equation}
f'(x)\approx {f(x+h)-f(x)\over h}\tp
\tag{2}
\end{equation}
$$

The idea is that we make a class to hold the function to be
differentiated, call it <code>f</code>, and a step size <code>h</code> to be used in
<a href="#mjx-eqn-2">(2)</a>.
These variables can be set in the
constructor.  The <code>__call__</code> operator computes the derivative with aid
of <a href="._class-bootstrap001.html#mjx-eqn-1">(1)</a>.  All this can be
coded in a few lines:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Derivative</span>(<span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, f, h<span style="color: #666666">=1E-5</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>f <span style="color: #666666">=</span> f
        <span style="color: #008000">self</span><span style="color: #666666">.</span>h <span style="color: #666666">=</span> <span style="color: #008000">float</span>(h)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, x):
        f, h <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>f, <span style="color: #008000">self</span><span style="color: #666666">.</span>h      <span style="color: #408080; font-style: italic"># make short forms</span>
        <span style="color: #008000; font-weight: bold">return</span> (f(x<span style="color: #666666">+</span>h) <span style="color: #666666">-</span> f(x))<span style="color: #666666">/</span>h
</pre></div>
<p>
Note that we turn <code>h</code> into a <code>float</code> to avoid
potential integer division.

<p>
Below follows an application of the class to differentiate two
functions \( f(x)=\sin x \)
and \( g(t)=t^3 \):

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> sin, cos, pi
<span style="color: #666666">&gt;&gt;&gt;</span> df <span style="color: #666666">=</span> Derivative(sin)
<span style="color: #666666">&gt;&gt;&gt;</span> x <span style="color: #666666">=</span> pi
<span style="color: #666666">&gt;&gt;&gt;</span> df(x)
<span style="color: #666666">-1.000000082740371</span>
<span style="color: #666666">&gt;&gt;&gt;</span> cos(x)  <span style="color: #408080; font-style: italic"># exact</span>
<span style="color: #666666">-1.0</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">g</span>(t):
<span style="color: #666666">...</span>     <span style="color: #008000; font-weight: bold">return</span> t<span style="color: #666666">**3</span>
<span style="color: #666666">...</span>
<span style="color: #666666">&gt;&gt;&gt;</span> dg <span style="color: #666666">=</span> Derivative(g)
<span style="color: #666666">&gt;&gt;&gt;</span> t <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> dg(t)  <span style="color: #408080; font-style: italic"># compare with 3 (exact)</span>
<span style="color: #666666">3.000000248221113</span>
</pre></div>
<p>
The expressions <code>df(x)</code> and <code>dg(t)</code>
look as ordinary Python functions that
evaluate the derivative of the functions <code>sin(x)</code> and <code>g(t)</code>.
Class <code>Derivative</code> works for (almost) any function \( f(x) \).

<h3 id="___sec30" class="anchor">Verification </h3>

<p>
It is a good programming habit to include a test function for
verifying the implementation of a class.
We can construct a test based on the fact that the
approximate differentiation formula <a href="#mjx-eqn-2">(2)</a>
is exact for linear functions:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_Derivative</span>():
    <span style="color: #408080; font-style: italic"># The formula is exact for linear functions, regardless of h</span>
    f <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> x: a<span style="color: #666666">*</span>x <span style="color: #666666">+</span> b
    a <span style="color: #666666">=</span> <span style="color: #666666">3.5</span>; b <span style="color: #666666">=</span> <span style="color: #666666">8</span>
    dfdx <span style="color: #666666">=</span> Derivative(f, h<span style="color: #666666">=0.5</span>)
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(dfdx(<span style="color: #666666">4.5</span>) <span style="color: #666666">-</span> a)
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> <span style="color: #666666">1E-14</span>, <span style="color: #BA2121">&#39;bug in class Derivative, diff=</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> diff
</pre></div>
<p>
We have here used a lambda function for compactly defining a function
<code>f</code>. The alternative would be to define <code>f</code> in the standard way

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(x):
    <span style="color: #008000; font-weight: bold">return</span> a<span style="color: #666666">*</span>x <span style="color: #666666">+</span> b
</pre></div>
<p>
A special feature of <code>f</code> is that it remembers the variables <code>a</code> and
<code>b</code> when <code>f</code> is sent to class <code>Derivative</code> (it is a closure,
see the section <a href="._class-bootstrap001.html#sec:class:closure">Closures</a>).
Note that the test function above follows
the conventions for test functions
outlined in the section <a href="._class-bootstrap002.html#sec:class:circle">A circle</a>.

<h3 id="___sec31" class="anchor">Application: Newton's method </h3>

<p>
In what situations will it be convenient to automatically produce a
Python function <code>df(x)</code> which is the derivative of another Python
function <code>f(x)</code>? One example arises when solving nonlinear algebraic
equations \( f(x)=0 \) with Newton's method and we, because of laziness,
lack of time, or lack of training do not manage to derive \( f'(x) \) by
hand. Consider a function <code>Newton</code> for solving \( f(x)=0 \): <code>Newton(f, x,
dfdx, epsilon=1.0E-7, N=100)</code>.
A specific implementation is found in the module file
<a href="http://tinyurl.com/pwyasaa/diffeq/Newton.py" target="_self"><tt>Newton.py</tt></a>.  The arguments are a
Python function <code>f</code> for \( f(x) \), a <code>float x</code> for the initial guess
(start value) of \( x \), a Python function <code>dfdx</code> for \( f'(x) \), a <code>float</code>
<code>epsilon</code> for the accuracy \( \epsilon \) of the root: the algorithms
iterates until \( |f(x)| < \epsilon \), and an <code>int N</code> for the maximum
number of iterations that we allow.  All arguments are easy to
provide, except <code>dfdx</code>, which requires computing \( f'(x) \) by hand then
implementation of the formula in a Python function.  Suppose our
target equation reads

$$
\begin{equation*}
f(x) =  10^5(x-0.9)^2(x-1.1)^3=0 \thinspace .
\end{equation*}
$$

The function \( f(x) \) is plotted in Figure
<a href="#fig:hard_polynomial4Newton1">2</a>.  The following session employs the
<code>Derivative</code> class to quickly make a derivative so we can call
Newton's method:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">classes</span> <span style="color: #008000; font-weight: bold">import</span> Derivative
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">Newton</span> <span style="color: #008000; font-weight: bold">import</span> Newton
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(x):
<span style="color: #666666">...</span>     <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">100000*</span>(x <span style="color: #666666">-</span> <span style="color: #666666">0.9</span>)<span style="color: #666666">**2</span> <span style="color: #666666">*</span> (x <span style="color: #666666">-</span> <span style="color: #666666">1.1</span>)<span style="color: #666666">**3</span>
<span style="color: #666666">...</span>
<span style="color: #666666">&gt;&gt;&gt;</span> df <span style="color: #666666">=</span> Derivative(f)
<span style="color: #666666">&gt;&gt;&gt;</span> Newton(f, <span style="color: #666666">1.01</span>, df, epsilon<span style="color: #666666">=1E-5</span>)
(<span style="color: #666666">1.0987610068093443</span>, <span style="color: #666666">8</span>, <span style="color: #666666">-7.5139644257961411e-06</span>)
</pre></div>
<p>
The output 3-tuple holds the approximation to a root, the number of
iterations, and the value of \( f \) at the approximate root (a measure of
the error in the equation).

<p>
<center> <!-- figure label: --> <div id="fig:hard_polynomial4Newton1"></div> <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 2:  Plot of \( y = 10^5(x-0.9)^2(x-1.1)^3 \).  <!-- caption label: fig:hard_polynomial4Newton1 --> </p></center>
<p><img src="fig-class/hard_polynomial4Newton1.png" align="bottom" width=400></p>
</center>

<p>
The exact root is 1.1, and the convergence toward this value is very
slow. (Newton's method converges very slowly when the derivative of
\( f \) is zero at the roots of \( f \). Even slower convergence appears when
higher-order derivatives also are zero, like in this example. Notice
that the error in <code>x</code> is much larger than the error in the equation
(<code>epsilon</code>).  For example, an <code>epsilon</code> tolerance of \( 10^{-10} \)
requires 18 iterations with an error of \( 10^{-3} \).)  Using an exact
derivative gives almost the same result:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">df_exact</span>(x):
<span style="color: #666666">...</span>     <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">100000*</span>(<span style="color: #666666">2*</span>(x<span style="color: #666666">-0.9</span>)<span style="color: #666666">*</span>(x<span style="color: #666666">-1.1</span>)<span style="color: #666666">**3</span> <span style="color: #666666">+</span> \ 
<span style="color: #666666">...</span>                    (x<span style="color: #666666">-0.9</span>)<span style="color: #666666">**2*3*</span>(x<span style="color: #666666">-1.1</span>)<span style="color: #666666">**2</span>)
<span style="color: #666666">...</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Newton(f, <span style="color: #666666">1.01</span>, df_exact, epsilon<span style="color: #666666">=1E-5</span>)
(<span style="color: #666666">1.0987610065618421</span>, <span style="color: #666666">8</span>, <span style="color: #666666">-7.5139689100699629e-06</span>)
</pre></div>
<p>
This example indicates that there are hardly any drawbacks in using a
"smart" inexact general differentiation approach as in the
<code>Derivative</code> class. The advantages are many - most notably,
<code>Derivative</code> avoids potential errors from possibly incorrect manual
coding of possibly lengthy expressions of possibly wrong
hand-calculations.  The errors in the involved approximations can be
made smaller, usually much smaller than other errors, like the
tolerance in Newton's method in this example or the uncertainty in
physical parameters in real-life problems.

<h3 id="___sec32" class="anchor">Solution utilizing SymPy </h3>

<p>
class <code>Derivative</code> is based on numerical differentiation, but it is
possible to make an equally short class that can do exact differentiation.
In SymPy, one can perform symbolic differentiation of an expression
<code>e</code> with respect to a symbolic independent variable <code>x</code> by
<code>diff(e, x)</code>.
Assuming that the user's <code>f</code> function can be evaluated for a
symbolic independent variable <code>x</code>, we can call <code>f(x)</code> to get
the SymPy expression for the formula in <code>f</code> and then use
<code>diff</code> to calculate the exact derivative. Thereafter, we turn
the symbolic expression of the derivative into an ordinary
Python function (via <code>lambdify</code>) and define this function as
the <code>__call__</code> method. The proper Python code is very short:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Derivative_sympy</span>(<span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, f):
        <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">import</span> Symbol, diff, lambdify
        x <span style="color: #666666">=</span> Symbol(<span style="color: #BA2121">&#39;x&#39;</span>)
        sympy_f <span style="color: #666666">=</span> f(x)   <span style="color: #408080; font-style: italic"># make sympy expression</span>
        sympy_dfdx <span style="color: #666666">=</span> diff(sympy_f, x)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>__call__ <span style="color: #666666">=</span> lambdify([x], sympy_dfdx)
</pre></div>
<p>
Note how the <code>__call__</code> method is defined by assigning a function
to it (even though the function returned by <code>lambdify</code> is a function
of <code>x</code> only, it works to call <code>obj(x)</code> for an instance <code>obj</code> of
type <code>Derivative_sympy</code>).

<p>
Both demonstration of the class and verification of the implementation
can be placed in a test function:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_Derivative_sympy</span>():
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">g</span>(t):
        <span style="color: #008000; font-weight: bold">return</span> t<span style="color: #666666">**3</span>

    dg <span style="color: #666666">=</span> Derivative_sympy(g)
    t <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    exact <span style="color: #666666">=</span> <span style="color: #666666">3*</span>t<span style="color: #666666">**2</span>
    computed <span style="color: #666666">=</span> dg(t)
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-14</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">abs</span>(exact <span style="color: #666666">-</span> computed) <span style="color: #666666">&lt;</span> tol

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">h</span>(y):
        <span style="color: #008000; font-weight: bold">return</span> exp(<span style="color: #666666">-</span>y)<span style="color: #666666">*</span>sin(<span style="color: #666666">2*</span>y)

    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">import</span> exp, sin
    dh <span style="color: #666666">=</span> Derivative_sympy(h)
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> pi, exp, sin, cos
    y <span style="color: #666666">=</span> pi
    exact <span style="color: #666666">=</span> <span style="color: #666666">-</span>exp(<span style="color: #666666">-</span>y)<span style="color: #666666">*</span>sin(<span style="color: #666666">2*</span>y) <span style="color: #666666">+</span> exp(<span style="color: #666666">-</span>y)<span style="color: #666666">*2*</span>cos(<span style="color: #666666">2*</span>y)
    computed <span style="color: #666666">=</span> dh(y)
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">abs</span>(exact <span style="color: #666666">-</span> computed) <span style="color: #666666">&lt;</span> tol
</pre></div>
<p>
The example with the <code>g(t)</code> should be straightforward to understand.
In the constructor of class <code>Derivative_sympy</code>, we call <code>g(x)</code>, with
the symbol <code>x</code>, and <code>g</code> returns the SymPy expression <code>x**3</code>.
The <code>__call__</code> method then becomes a function <code>lambda x: 3*x**2</code>.

<p>
The <code>h(y)</code> function, however, deserves more explanation. When then
constructor of class <code>Derivative_sympy</code> makes the call <code>h(x)</code>, with
the symbol <code>x</code>, the <code>h</code> function will return the SymPy expression
<code>exp(-x)*sin(2*x)</code>, provided <code>exp</code> and <code>sin</code> are SymPy functions.
Since we do <code>from sympy import exp, sin</code> prior to calling the
constructor in class <code>Derivative_sympy</code>, the names <code>exp</code> and <code>sin</code>
are defined in the test function, and our local <code>h</code> function will
have access to all local variables, as it is a closure as mentioned
above and in the section <a href="._class-bootstrap001.html#sec:class:closure">Closures</a>.
This means that <code>h</code> has access to <code>sympy.sin</code> and <code>sympy.cos</code>
when the constructor in class <code>Derivative_sympy</code> calls <code>h</code>.
Thereafter, we want to do some numerical computing and need
<code>exp</code>, <code>sin</code>, and <code>cos</code> from the <code>math</code> module. If we had tried
to do <code>Derivative_sympy(h)</code> after the import from <code>math</code>,
<code>h</code> would then call <code>math.exp</code> and <code>math.sin</code> with a SymPy
symbol as argument, and would cause a <code>TypeError</code> since
<code>math.exp</code> expects a <code>float</code>, not a <code>Symbol</code> object from SymPy.

<p>
Although the <code>Derivative_sympy</code> class is small and compact, its
construction and use as explained here bring up more
advanced topics than class <code>Derivative</code> and its plain numerical
computations. However, it may be interesting to see that
a class for exact differentiation of a Python function can be
realized in very few lines.

<h2 id="sec:class:autoint" class="anchor">Example: Automagic integration</h2>

<p>
We can apply the ideas from the section <a href="#sec:class:autodF">Example: Automagic differentiation</a> to
make a class for computing the integral of a function numerically.
Given a function \( f(x) \), we want to compute

$$
\begin{equation*}
F(x; a) = \int_a^x f(t)dt  \thinspace .
\end{equation*}
$$

The computational technique consists of using the Trapezoidal rule with \( n \)
intervals (\( n+1 \) points):

$$
\begin{equation}
\int_a^x f(t)dt = h\left(\frac{1}{2}f(a) + \sum_{i=1}^{n-1} f(a+ih) + \frac{1}{2}f(x)\right),\ 
\tag{3}
\end{equation}
$$

where \( h=(x-a)/n \).
In an application
program, we want to compute \( F(x;a) \) by a simple syntax like

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(x):
    <span style="color: #008000; font-weight: bold">return</span> exp(<span style="color: #666666">-</span>x<span style="color: #666666">**2</span>)<span style="color: #666666">*</span>sin(<span style="color: #666666">10*</span>x)

a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; n <span style="color: #666666">=</span> <span style="color: #666666">200</span>
F <span style="color: #666666">=</span> Integral(f, a, n)
<span style="color: #008000; font-weight: bold">print</span> F(x)
</pre></div>
<p>
Here, <code>f(x)</code> is the Python function to be integrated, and <code>F(x)</code>
behaves as a Python function that calculates values of \( F(x;a) \).

<h3 id="___sec34" class="anchor">A simple implementation </h3>

<p>
Consider a straightforward implementation of the Trapezoidal rule
in a Python function:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">trapezoidal</span>(f, a, x, n):
    h <span style="color: #666666">=</span> (x<span style="color: #666666">-</span>a)<span style="color: #666666">/</span><span style="color: #008000">float</span>(n)
    I <span style="color: #666666">=</span> <span style="color: #666666">0.5*</span>f(a)
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, n):
        I <span style="color: #666666">+=</span> f(a <span style="color: #666666">+</span> i<span style="color: #666666">*</span>h)
    I <span style="color: #666666">+=</span> <span style="color: #666666">0.5*</span>f(x)
    I <span style="color: #666666">*=</span> h
    <span style="color: #008000; font-weight: bold">return</span> I
</pre></div>
<p>
Class <code>Integral</code> must have some data attributes and a <code>__call__</code>
method. Since the latter method is supposed to take <code>x</code> as argument,
the other parameters <code>a</code>, <code>f</code>, and <code>n</code> must be data attributes.  The
implementation then becomes

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Integral</span>(<span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, f, a, n<span style="color: #666666">=100</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>f, <span style="color: #008000">self</span><span style="color: #666666">.</span>a, <span style="color: #008000">self</span><span style="color: #666666">.</span>n <span style="color: #666666">=</span> f, a, n

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, x):
        <span style="color: #008000; font-weight: bold">return</span> trapezoidal(<span style="color: #008000">self</span><span style="color: #666666">.</span>f, <span style="color: #008000">self</span><span style="color: #666666">.</span>a, x, <span style="color: #008000">self</span><span style="color: #666666">.</span>n)
</pre></div>
<p>
Observe that we just reuse the <code>trapezoidal</code> function to perform
the calculation. We could alternatively have copied the body of
the <code>trapezoidal</code> function into the <code>__call__</code> method.
However, if we already have this algorithm implemented and tested as
a function, it is better to call the function.
The class is then known as a <em>wrapper</em> of the underlying function.
A wrapper allows something to be called with alternative syntax.

<p>
An application program computing \( \int_0^{2\pi}\sin x\, dx \)
might look as follows:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">math</span> <span style="color: #008000; font-weight: bold">import</span> sin, pi

G <span style="color: #666666">=</span> Integral(sin, <span style="color: #666666">0</span>, <span style="color: #666666">200</span>)
value <span style="color: #666666">=</span> G(<span style="color: #666666">2*</span>pi)
</pre></div>
<p>
An equivalent calculation is

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>value <span style="color: #666666">=</span> trapezoidal(sin, <span style="color: #666666">0</span>, <span style="color: #666666">2*</span>pi, <span style="color: #666666">200</span>)
</pre></div>

<h3 id="___sec35" class="anchor">Verification via symbolic computing </h3>

<p>
We should always provide a test function for verification of
the implementation. To avoid dealing with unknown approximation errors
of the Trapezoidal rule, we use the obvious fact that linear functions
are integrated exactly by the rule. Although it is really easy to
pick a linear function, integrate it, and figure out what an integral
is, we can also demonstrate how to automate such a process by
SymPy. Essentially, we define an
expression in SymPy, ask SymPy to integrate it, and then turn
the resulting symbolic integral to a plain Python function for
computing:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">sp</span>
<span style="color: #666666">&gt;&gt;&gt;</span> x <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>Symbol(<span style="color: #BA2121">&#39;x&#39;</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> f_expr <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>cos(x) <span style="color: #666666">+</span> <span style="color: #666666">5*</span>x
<span style="color: #666666">&gt;&gt;&gt;</span> f_expr
<span style="color: #666666">5*</span>x <span style="color: #666666">+</span> cos(x)
<span style="color: #666666">&gt;&gt;&gt;</span> F_expr <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>integrate(f_expr, x)
<span style="color: #666666">&gt;&gt;&gt;</span> F_expr
<span style="color: #666666">5*</span>x<span style="color: #666666">**2/2</span> <span style="color: #666666">+</span> sin(x)
<span style="color: #666666">&gt;&gt;&gt;</span> F <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>lambdify([x], F_expr)  <span style="color: #408080; font-style: italic"># turn f_expr to F(x) func.</span>
<span style="color: #666666">&gt;&gt;&gt;</span> F(<span style="color: #666666">0</span>)
<span style="color: #666666">0.0</span>
<span style="color: #666666">&gt;&gt;&gt;</span> F(<span style="color: #666666">1</span>)
<span style="color: #666666">3.3414709848078967</span>
</pre></div>
<p>
Using such functionality to do exact integration, we can write
our test function as

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_Integral</span>():
    <span style="color: #408080; font-style: italic"># The Trapezoidal rule is exact for linear functions</span>
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">sp</span>
    x <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>Symbol(<span style="color: #BA2121">&#39;x&#39;</span>)
    f_expr <span style="color: #666666">=</span> <span style="color: #666666">2*</span>x <span style="color: #666666">+</span> <span style="color: #666666">5</span>
    <span style="color: #408080; font-style: italic"># Turn sympy expression into plain Python function f(x)</span>
    f <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>lambdify([x], f_expr)
    <span style="color: #408080; font-style: italic"># Find integral of f_expr and turn into plain Python function F</span>
    F_expr <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>integrate(f_expr, x)
    F <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>lambdify([x], F_expr)

    a <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    x <span style="color: #666666">=</span> <span style="color: #666666">6</span>
    exact <span style="color: #666666">=</span> F(x) <span style="color: #666666">-</span> F(a)
    computed <span style="color: #666666">=</span> Integral(f, a, n<span style="color: #666666">=4</span>)
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(exact <span style="color: #666666">-</span> computed)
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-15</span>
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> tol, <span style="color: #BA2121">&#39;bug in class Integral, diff=</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> diff
</pre></div>
<p>
If you think it is overkill to use SymPy for integrating linear
functions, you can equally well do it yourself and define
<code>f = lambda x: 2*x + 5</code> and <code>F = lambda x: x**2 + 5*x</code>.

<h3 id="___sec36" class="anchor">Remark </h3>

<p>
Class <code>Integral</code> is inefficient (but probably more
than fast enough) for plotting \( F(x;a) \) as a function \( x \).
<a href="._class-bootstrap008.html#sec:class:ex13c">Exercise 22: Speed up repeated integral calculations</a> suggests to optimize the class
for this purpose.

<h2 id="sec:class:str" class="anchor">Turning an instance into a string</h2>

<p>
Another useful special method is <code>__str__</code>. It is called when
a class instance needs to be converted to a string. This happens when
we say <code>print a</code>, and <code>a</code> is an instance.
Python will then look into the <code>a</code> instance
for a <code>__str__</code> method, which is supposed to return a string.
If such a special method is found, the returned string is printed,
otherwise just the name of the class is printed. An example will illustrate
the point. First we try to print an <code>y</code> instance of class
<code>Y</code> from the section <a href="._class-bootstrap001.html#sec:class:func2">Representing a function as a class</a>
(where there is no <code>__str__</code> method):

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> y
<span style="color: #666666">&lt;</span>__main__<span style="color: #666666">.</span>Y instance at <span style="color: #666666">0xb751238c&gt;</span>
</pre></div>
<p>
This means that <code>y</code> is an <code>Y</code> instance in the <code>__main__</code>
module (the main program or the interactive session). The output also
contains an address telling where the <code>y</code> instance is stored
in the computer's memory.

<p>
If we want <code>print y</code> to print out the <code>y</code> instance, we need
to define the <code>__str__</code> method in class <code>Y</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Y</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__str__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;v0*t - 0.5*g*t**2; v0=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>v0
</pre></div>
<p>
Typically, <code>__str__</code> replaces our previous <code>formula</code>
method and <code>__call__</code> replaces our previous <code>value</code> method.
Python programmers with the experience that we now have gained will
therefore write class <code>Y</code> with special methods only:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Y</span>(<span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, v0):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>v0 <span style="color: #666666">=</span> v0
        <span style="color: #008000">self</span><span style="color: #666666">.</span>g <span style="color: #666666">=</span> <span style="color: #666666">9.81</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, t):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>v0<span style="color: #666666">*</span>t <span style="color: #666666">-</span> <span style="color: #666666">0.5*</span><span style="color: #008000">self</span><span style="color: #666666">.</span>g<span style="color: #666666">*</span>t<span style="color: #666666">**2</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__str__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;v0*t - 0.5*g*t**2; v0=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>v0
</pre></div>
<p>
Let us see the class in action:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> y <span style="color: #666666">=</span> Y(<span style="color: #666666">1.5</span>)
<span style="color: #666666">&gt;&gt;&gt;</span> y(<span style="color: #666666">0.2</span>)
<span style="color: #666666">0.1038</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> y
v0<span style="color: #666666">*</span>t <span style="color: #666666">-</span> <span style="color: #666666">0.5*</span>g<span style="color: #666666">*</span>t<span style="color: #666666">**2</span>; v0<span style="color: #666666">=1.5</span>
</pre></div>
<p>
What have we gained by using special methods? Well, we can still only
evaluate the formula and write it out, but many users of the class will
claim that the syntax is more attractive since <code>y(t)</code> in code
means \( y(t) \) in mathematics,
and we can do a <code>print y</code> to view the formula.
The bottom line of using special methods is to achieve a more
user-friendly syntax. The next sections illustrate this point further.

<p>
Note that the <code>__str__</code> method is called whenever we do <code>str(a)</code>, and
<code>print a</code> is effectively <code>print str(a)</code>, i.e., <code>print a.__str__()</code>.

<h2 id="sec:class:phonebook2" class="anchor">Example: Phone book with special methods</h2>

<p>
Let us reconsider class <code>Person</code> from the section <a href="._class-bootstrap002.html#sec:class:phonebook">Phone book</a>.
The <code>dump</code> method in that class is better implemented as
a <code>__str__</code> special method. This is easy: we just change
the method name and replace <code>print s</code> by <code>return s</code>.

<p>
Storing <code>Person</code> instances in a dictionary to form a phone book is
straightforward. However, we make the dictionary a bit easier to use
if we wrap a class around it. That is, we make a class <code>PhoneBook</code>
which holds the dictionary as an attribute. An
<code>add</code> method can be used to add a new person:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">PhoneBook</span>(<span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>contacts <span style="color: #666666">=</span> {}   <span style="color: #408080; font-style: italic"># dict of Person instances</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(<span style="color: #008000">self</span>, name, mobile<span style="color: #666666">=</span><span style="color: #008000">None</span>, office<span style="color: #666666">=</span><span style="color: #008000">None</span>,
            private<span style="color: #666666">=</span><span style="color: #008000">None</span>, email<span style="color: #666666">=</span><span style="color: #008000">None</span>):
        p <span style="color: #666666">=</span> Person(name, mobile, office, private, email)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>contacts[name] <span style="color: #666666">=</span> p
</pre></div>
<p>
A <code>__str__</code> can print the phone book in alphabetic order:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__str__</span>(<span style="color: #008000">self</span>):
        s <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>
        <span style="color: #008000; font-weight: bold">for</span> p <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">sorted</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>contacts):
            s <span style="color: #666666">+=</span> <span style="color: #008000">str</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>contacts[p]) <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&#39;</span>
        <span style="color: #008000; font-weight: bold">return</span> s
</pre></div>
<p>
To retrieve a <code>Person</code> instance, we use the <code>__call__</code>
with the person's name as argument:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, name):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>contacts[name]
</pre></div>
<p>
The only advantage of this method is simpler syntax: for a <code>PhoneBook</code>
<code>b</code> we can get data about <code>NN</code> by calling
<code>b('NN')</code> rather than accessing the internal dictionary
<code>b.contacts['NN']</code>.

<p>
We can make a simple demo code for a phone book with three
names:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>b <span style="color: #666666">=</span> PhoneBook()
b<span style="color: #666666">.</span>add(<span style="color: #BA2121">&#39;Ole Olsen&#39;</span>, office<span style="color: #666666">=</span><span style="color: #BA2121">&#39;767828292&#39;</span>,
      email<span style="color: #666666">=</span><span style="color: #BA2121">&#39;olsen@somemail.net&#39;</span>)
b<span style="color: #666666">.</span>add(<span style="color: #BA2121">&#39;Hans Hanson&#39;</span>,
      office<span style="color: #666666">=</span><span style="color: #BA2121">&#39;767828283&#39;</span>, mobile<span style="color: #666666">=</span><span style="color: #BA2121">&#39;995320221&#39;</span>)
b<span style="color: #666666">.</span>add(<span style="color: #BA2121">&#39;Per Person&#39;</span>, mobile<span style="color: #666666">=</span><span style="color: #BA2121">&#39;906849781&#39;</span>)
<span style="color: #008000; font-weight: bold">print</span> b(<span style="color: #BA2121">&#39;Per Person&#39;</span>)
<span style="color: #008000; font-weight: bold">print</span> b
</pre></div>
<p>
The output becomes

<p>

<!-- code=text (!bc ccq) typeset with pygments style "default" -->
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Per Person
mobile phone:   906849781

Hans Hanson
mobile phone:   995320221
office phone:   767828283

Ole Olsen
office phone:   767828292
email address:  olsen@somemail.net

Per Person
mobile phone:   906849781
</pre></div>
</blockquote><p>
You are strongly encouraged to work through this last demo program
by hand and simulate what the program does. That is, jump around in
the code and write down on a piece of paper what various variables
contain after each statement. This is an important and good exercise!
You enjoy the happiness of mastering classes if you get the same output
as above. The complete program with classes <code>Person</code> and
<code>PhoneBook</code> and the test above is found in the file
<a href="http://tinyurl.com/pwyasaa/class/PhoneBook.py" target="_self"><tt>PhoneBook.py</tt></a>.
You can run this program, statement by statement,
either in the <a href="http://www.pythontutor.com/" target="_self">Online Python Tutor</a> or
in a debugger (see the document <a href="http://hplgit.github.io/primer.html/doc/pub/debug" target="_self">Debugging in Python</a> <a href="._class-bootstrap008.html#Langtangen_TCSE6_debug">[3]</a>)
to control that your understanding of the program flow is correct.

<h3 id="___sec39" class="anchor">Remark </h3>

<p>
Note that the names are sorted with respect to the first names.
The reason is that strings are sorted after the first character,
then the second character, and so on.
We can supply our own tailored sort
function.
One possibility is to split the
name into words and use the last word for sorting:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">last_name_sort</span>(name1, name2):
    lastname1 <span style="color: #666666">=</span> name1<span style="color: #666666">.</span>split()[<span style="color: #666666">-1</span>]
    lastname2 <span style="color: #666666">=</span> name2<span style="color: #666666">.</span>split()[<span style="color: #666666">-1</span>]
    <span style="color: #008000; font-weight: bold">if</span> lastname1 <span style="color: #666666">&lt;</span> lastname2:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">-1</span>
    <span style="color: #008000; font-weight: bold">elif</span> lastname1 <span style="color: #666666">&gt;</span> lastname2:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">else</span>: <span style="color: #408080; font-style: italic"># equality</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0</span>

<span style="color: #008000; font-weight: bold">for</span> p <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">sorted</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>contacts, last_name_sort):
   <span style="color: #666666">...</span>
</pre></div>

<h2 id="sec:class:add" class="anchor">Adding objects</h2>

<p>
Let <code>a</code> and <code>b</code> be instances of some class <code>C</code>. Does it
make sense to write <code>a + b</code>? Yes, this makes sense if class
<code>C</code> has defined a special method <code>__add__</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">C</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    __add__(<span style="color: #008000">self</span>, other):
        <span style="color: #666666">...</span>
</pre></div>
<p>
The <code>__add__</code> method should add the instances <code>self</code>
and <code>other</code> and return the result as an instance.
So when Python encounters <code>a + b</code>, it will check if class
<code>C</code> has an <code>__add__</code> method and interpret <code>a + b</code>
as the call <code>a.__add__(b)</code>.
The next example will hopefully clarify what this idea can be used for.

<h2 id="sec:class:Polynomial" class="anchor">Example: Class for polynomials</h2>

<p>
Let us create a class <code>Polynomial</code>
for polynomials. The coefficients in the polynomial can be given to
the constructor as a list. Index number \( i \) in this list represents the
coefficients of the \( x^i \) term in the polynomial. That is, writing
<code>Polynomial([1,0,-1,2])</code>
defines a polynomial

$$
\begin{equation*} 1 + 0\cdot x - 1\cdot x^2 + 2\cdot x^3 =
1 - x^2 + 2x^3 \thinspace .
\end{equation*}
$$

Polynomials can be added (by just adding the coefficients corresponding
to the same powers)
so our class may have
an <code>__add__</code> method.
A <code>__call__</code> method is natural for evaluating the polynomial,
given a value of \( x \). The class is listed below and explained afterwards.

<h3 id="___sec42" class="anchor">Implementation </h3>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Polynomial</span>(<span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, coefficients):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff <span style="color: #666666">=</span> coefficients

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, x):
        <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Evaluate the polynomial.&quot;&quot;&quot;</span>
        s <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff)):
            s <span style="color: #666666">+=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i]<span style="color: #666666">*</span>x<span style="color: #666666">**</span>i
        <span style="color: #008000; font-weight: bold">return</span> s

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__add__</span>(<span style="color: #008000">self</span>, other):
        <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return self + other as Polynomial object.&quot;&quot;&quot;</span>
        <span style="color: #408080; font-style: italic"># Two cases:</span>
        <span style="color: #408080; font-style: italic">#</span>
        <span style="color: #408080; font-style: italic"># self:   X X X X X X X</span>
        <span style="color: #408080; font-style: italic"># other:  X X X</span>
        <span style="color: #408080; font-style: italic">#</span>
        <span style="color: #408080; font-style: italic"># or:</span>
        <span style="color: #408080; font-style: italic">#</span>
        <span style="color: #408080; font-style: italic"># self:   X X X X X</span>
        <span style="color: #408080; font-style: italic"># other:  X X X X X X X X</span>

        <span style="color: #408080; font-style: italic"># Start with the longest list and add in the other</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff) <span style="color: #666666">&gt;</span> <span style="color: #008000">len</span>(other<span style="color: #666666">.</span>coeff):
            result_coeff <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[:]  <span style="color: #408080; font-style: italic"># copy!</span>
            <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(other<span style="color: #666666">.</span>coeff)):
                result_coeff[i] <span style="color: #666666">+=</span> other<span style="color: #666666">.</span>coeff[i]
        <span style="color: #008000; font-weight: bold">else</span>:
            result_coeff <span style="color: #666666">=</span> other<span style="color: #666666">.</span>coeff[:] <span style="color: #408080; font-style: italic"># copy!</span>
            <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff)):
                result_coeff[i] <span style="color: #666666">+=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i]
        <span style="color: #008000; font-weight: bold">return</span> Polynomial(result_coeff)
</pre></div>
<p>
Class <code>Polynomial</code> has one data attribute: the list of coefficients.
To evaluate the polynomial, we just sum up coefficient no. \( i \) times
\( x^i \) for \( i=0 \) to the number of coefficients in the list.

<p>
The <code>__add__</code> method looks more advanced. The goal is to add the two
lists of coefficients. However, it may happen that the lists are of
unequal length. We therefore start with the longest list and add in
the other list, element by element.  Observe that <code>result_coeff</code>
starts out as a <em>copy</em> of <code>self.coeff</code>: if not, changes in
<code>result_coeff</code> as we compute the sum will be reflected in
<code>self.coeff</code>. This means that <code>self</code> would be the sum of itself and
the <code>other</code> instance, or in other words, adding two instances,
<code>p1+p2</code>, changes <code>p1</code> - this is not what we want!  An alternative
implementation of class <code>Polynomial</code> is found in <a href="._class-bootstrap008.html#sec:class:ex4">Exercise 24: Find a bug in a class for polynomials</a>.

<p>
A subtraction method <code>__sub__</code> can be implemented along the lines of
<code>__add__</code>, but is slightly more complicated and left as
<a href="._class-bootstrap008.html#sec:class:ex6a">Exercise 25: Implement subtraction of polynomials</a>. You are strongly encouraged to do
this exercise as it will help increase the understanding of
the interplay between mathematics and programming in class
<code>Polynomial</code>.

<p>
A more complicated
operation on polynomials,
from a mathematical point of view, is the multiplication of
two polynomials. Let \( p(x)=\sum_{i=0}^Mc_ix^i \) and \( q(x)=\sum_{j=0}^N
d_jx^j \) be the two polynomials. The product becomes

$$
\begin{equation*} \left(\sum_{i=0}^Mc_ix^i\right)\left( \sum_{j=0}^N d_jx^j\right)
= \sum_{i=0}^M \sum_{j=0}^N c_id_j x^{i+j} \thinspace . \end{equation*}
$$

The double sum must be implemented as a double loop, but first the
list for the resulting polynomial must be created with length \( M+N+1 \)
(the highest exponent is \( M+N \) and then we need a constant term).
The implementation of the multiplication operator becomes

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__mul__</span>(<span style="color: #008000">self</span>, other):
        c <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff
        d <span style="color: #666666">=</span> other<span style="color: #666666">.</span>coeff
        M <span style="color: #666666">=</span> <span style="color: #008000">len</span>(c) <span style="color: #666666">-</span> <span style="color: #666666">1</span>
        N <span style="color: #666666">=</span> <span style="color: #008000">len</span>(d) <span style="color: #666666">-</span> <span style="color: #666666">1</span>
        result_coeff <span style="color: #666666">=</span> numpy<span style="color: #666666">.</span>zeros(M<span style="color: #666666">+</span>N<span style="color: #666666">+1</span>)
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, M<span style="color: #666666">+1</span>):
            <span style="color: #008000; font-weight: bold">for</span> j <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, N<span style="color: #666666">+1</span>):
                result_coeff[i<span style="color: #666666">+</span>j] <span style="color: #666666">+=</span> c[i]<span style="color: #666666">*</span>d[j]
        <span style="color: #008000; font-weight: bold">return</span> Polynomial(result_coeff)
</pre></div>
<p>
We could also include a method for
differentiating the polynomial according to the formula

$$
\begin{equation*}
{d\over dx}\sum_{i=0}^n c_ix^i = \sum_{i=1}^n ic_ix^{i-1} \thinspace .
\end{equation*}
$$

If \( c_i \) is stored as a list <code>c</code>,
the list representation of the derivative, say its name is <code>dc</code>,
fulfills <code>dc[i-1] = i*c[i]</code> for <code>i</code> running from 1 to the
largest index in <code>c</code>. Note that <code>dc</code> has one element less
than <code>c</code>.

<p>
There are two different ways of implementing the differentiation
functionality, either by changing the polynomial coefficients, or by
returning a new <code>Polynomial</code> instance from the method such that the
original polynomial instance is intact.  We let <code>p.differentiate()</code> be
an implementation of the first approach, i.e., this method does not
return anything, but the coefficients in the <code>Polynomial</code> instance <code>p</code>
are altered.  The other approach is implemented by <code>p.derivative()</code>,
which returns a new <code>Polynomial</code> object with coefficients
corresponding to the derivative of <code>p</code>.

<p>
The complete implementation of the two methods
is given below:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Polynomial</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">differentiate</span>(<span style="color: #008000">self</span>):
        <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Differentiate this polynomial in-place.&quot;&quot;&quot;</span>
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, <span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff)):
            <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> i<span style="color: #666666">*</span><span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i]
        <span style="color: #008000; font-weight: bold">del</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[<span style="color: #666666">-1</span>]

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">derivative</span>(<span style="color: #008000">self</span>):
        <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Copy this polynomial and return its derivative.&quot;&quot;&quot;</span>
        dpdx <span style="color: #666666">=</span> Polynomial(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[:])  <span style="color: #408080; font-style: italic"># make a copy</span>
        dpdx<span style="color: #666666">.</span>differentiate()
        <span style="color: #008000; font-weight: bold">return</span> dpdx
</pre></div>
<p>
The <code>Polynomial</code> class with a <code>differentiate</code> method and not a
<code>derivative</code> method would be mutable (i.e., the object's content can
change) and allow in-place changes of the data, while the <code>Polynomial</code>
class with <code>derivative</code> and not <code>differentiate</code> would yield an
immutable object where the polynomial initialized in the constructor
is never altered.  (Technically, it is possible to grab the <code>coeff</code>
variable in a class instance and alter this list. By starting <code>coeff</code>
with an underscore, a Python programming convention tells programmers
that this variable is for internal use in the class only, and not to
be altered by users of the instance, see the sections <a href="._class-bootstrap002.html#sec:class:account">Bank accounts</a> and <a href="._class-bootstrap005.html#sec:class:illegalop">Illegal operations</a>.)  A good rule is
to offer only one of these two functions such that a <code>Polynomial</code>
object is either mutable or immutable (if we leave out
<code>differentiate</code>, its function body must of course be copied into
<code>derivative</code> since <code>derivative</code> now relies on that code).  However,
since the main purpose of this class is to illustrate various types of
programming techniques, we keep both versions.

<h3 id="___sec43" class="anchor">Usage </h3>

<p>
As a demonstration of the functionality of class <code>Polynomial</code>, we introduce
the two polynomials

$$
\begin{equation*} p_1(x)= 1-x,\quad p_2(x)=x - 6x^4 - x^5  \thinspace . \end{equation*}
$$

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> p1 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">1</span>, <span style="color: #666666">-1</span>])
<span style="color: #666666">&gt;&gt;&gt;</span> p2 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">-1</span>])
<span style="color: #666666">&gt;&gt;&gt;</span> p3 <span style="color: #666666">=</span> p1 <span style="color: #666666">+</span> p2
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> p3<span style="color: #666666">.</span>coeff
[<span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">-1</span>]
<span style="color: #666666">&gt;&gt;&gt;</span> p4 <span style="color: #666666">=</span> p1<span style="color: #666666">*</span>p2
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> p4<span style="color: #666666">.</span>coeff
[<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">-1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">5</span>, <span style="color: #666666">1</span>]
<span style="color: #666666">&gt;&gt;&gt;</span> p5 <span style="color: #666666">=</span> p2<span style="color: #666666">.</span>derivative()
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> p5<span style="color: #666666">.</span>coeff
[<span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-24</span>, <span style="color: #666666">-5</span>]
</pre></div>
<p>
One verification of the implementation may be to compare
<code>p3</code> at (e.g.) \( x=1/2 \) with \( p_1(x) + p_2(x) \):

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> x <span style="color: #666666">=</span> <span style="color: #666666">0.5</span>
<span style="color: #666666">&gt;&gt;&gt;</span> p1_plus_p2_value <span style="color: #666666">=</span> p1(x) <span style="color: #666666">+</span> p2(x)
<span style="color: #666666">&gt;&gt;&gt;</span> p3_value <span style="color: #666666">=</span> p3(x)
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> p1_plus_p2_value <span style="color: #666666">-</span> p3_value
<span style="color: #666666">0.0</span>
</pre></div>
<p>
Note that <code>p1 + p2</code> is very different from <code>p1(x) + p2(x)</code>.  In the
former case, we add two instances of class <code>Polynomial</code>, while in the
latter case we add two instances of class <code>float</code> (since <code>p1(x)</code> and
<code>p2(x)</code> imply calling <code>__call__</code> and that method returns a <code>float</code>
object).

<h3 id="___sec44" class="anchor">Pretty print of polynomials </h3>

<p>
The <code>Polynomial</code> class can also be equipped with a
<code>__str__</code> method for printing the polynomial to the screen.
A first, rough implementation could simply add up strings
of the form <code>+ self.coeff[i]*x^i</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Polynomial</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__str__</span>(<span style="color: #008000">self</span>):
        s <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff)):
            s <span style="color: #666666">+=</span> <span style="color: #BA2121">&#39; + </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">*x^</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i], i)
        <span style="color: #008000; font-weight: bold">return</span> s
</pre></div>
<p>
However, this implementation leads to ugly output from a mathematical
viewpoint. For instance,
a polynomial with coefficients <code>[1,0,0,-1,-6]</code>
gets printed as

<p>

<!-- code=text (!bc ccq) typeset with pygments style "default" -->
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> + 1*x^0 + 0*x^1 + 0*x^2 + -1*x^3 + -6*x^4
</pre></div>
</blockquote><p>
A more desired output would be

<p>

<!-- code=text (!bc ccq) typeset with pygments style "default" -->
<blockquote>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>1 - x^3 - 6*x^4
</pre></div>
</blockquote><p>
That is, terms with a zero coefficient should be dropped; a part <code>'+
-'</code> of the output string should be replaced by <code>'- '</code>; unit
coefficients should be dropped, i.e., <code>' 1*'</code> should be replaced by
space <code>' '</code>; unit power should be dropped by replacing <code>'x^1 '</code> by <code>'x
'</code>; zero power should be dropped and replaced by <code>1</code>, initial spaces
should be fixed, etc.  These adjustments can be implemented using the
<code>replace</code> method in string objects and by composing slices of the
strings. The new version of the <code>__str__</code> method below contains the
necessary adjustments. If you find this type of string manipulation
tricky and difficult to understand, you may safely skip further
inspection of the improved <code>__str__</code> code since the details are not
essential for your present learning about the class concept and
special methods.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Polynomial</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__str__</span>(<span style="color: #008000">self</span>):
        s <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, <span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff)):
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i] <span style="color: #666666">!=</span> <span style="color: #666666">0</span>:
                s <span style="color: #666666">+=</span> <span style="color: #BA2121">&#39; + </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">*x^</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (<span style="color: #008000">self</span><span style="color: #666666">.</span>coeff[i], i)
        <span style="color: #408080; font-style: italic"># Fix layout</span>
        s <span style="color: #666666">=</span> s<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&#39;+ -&#39;</span>, <span style="color: #BA2121">&#39;- &#39;</span>)
        s <span style="color: #666666">=</span> s<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&#39;x^0&#39;</span>, <span style="color: #BA2121">&#39;1&#39;</span>)
        s <span style="color: #666666">=</span> s<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&#39; 1*&#39;</span>, <span style="color: #BA2121">&#39; &#39;</span>)
        s <span style="color: #666666">=</span> s<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&#39;x^1 &#39;</span>, <span style="color: #BA2121">&#39;x &#39;</span>)
        <span style="color: #008000; font-weight: bold">if</span> s[<span style="color: #666666">0</span>:<span style="color: #666666">3</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39; + &#39;</span>:  <span style="color: #408080; font-style: italic"># remove initial +</span>
            s <span style="color: #666666">=</span> s[<span style="color: #666666">3</span>:]
        <span style="color: #008000; font-weight: bold">if</span> s[<span style="color: #666666">0</span>:<span style="color: #666666">3</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39; - &#39;</span>:  <span style="color: #408080; font-style: italic"># fix spaces for initial -</span>
            s <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;-&#39;</span> <span style="color: #666666">+</span> s[<span style="color: #666666">3</span>:]
        <span style="color: #008000; font-weight: bold">return</span> s
</pre></div>
<p>
Programming sometimes turns into coding (what one think is)
a general solution followed
by a series of special cases to fix caveats in the &quot;general&quot; solution,
just as we experienced with the <code>__str__</code> method above.
This situation often calls for additional future fixes and is often
a sign of a suboptimal solution to the programming problem.

<p>
Pretty print of <code>Polynomial</code> instances can be demonstrated in an
interactive session:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> p1 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">1</span>, <span style="color: #666666">-1</span>])
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> p1
<span style="color: #666666">1</span> <span style="color: #666666">-</span> x<span style="color: #666666">^1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> p2 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">-1</span>])
<span style="color: #666666">&gt;&gt;&gt;</span> p2<span style="color: #666666">.</span>differentiate()
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> p2
<span style="color: #666666">1</span> <span style="color: #666666">-</span> <span style="color: #666666">24*</span>x<span style="color: #666666">^3</span> <span style="color: #666666">-</span> <span style="color: #666666">5*</span>x<span style="color: #666666">^4</span>
</pre></div>

<h3 id="___sec45" class="anchor">Verifying the implementation </h3>

<p>
It is always a good habit to include a test function <code>test_Polynomial()</code>
for verifying the functionality in class <code>Polynomial</code>.
To this end, we construct some examples of addition, multiplication,
and differentiation of polynomials by hand and make tests that class
<code>Polynomial</code> reproduces the correct results. Testing the <code>__str__</code>
method is left as <a href="._class-bootstrap008.html#sec:class:exer:str">Exercise 26: Test the functionality of pretty print of polynomials</a>.

<p>
Rounding errors may be an issue in class <code>Polynomial</code>: <code>__add__</code>,
<code>derivative</code>, and <code>differentiate</code> will lead to integer coefficients if
the polynomials to be added have integer coefficients, while <code>__mul__</code>
always results in a polynomial with the coefficients stored in a
<code>numpy</code> array with <code>float</code> elements. Integer coefficients in lists can
be compared using <code>==</code> for lists, while coefficients in <code>numpy</code> arrays
must be compared with a tolerance. One can either subtract the <code>numpy</code>
arrays and use the <code>max</code> method to find the largest deviation and
compare this with a tolerance, or one can use <code>numpy.allclose(a, b,
rtol=tol)</code> for comparing the arrays <code>a</code> and <code>b</code> with a (relative)
tolerance <code>tol</code>.

<p>
Let us pick polynomials with integer coefficients as test cases
such that <code>__add__</code>, <code>derivative</code>, and <code>differentiate</code> can
be verified by testing equality (<code>==</code>) of the <code>coeff</code> lists.
Multiplication in <code>__mul__</code> must employ <code>numpy.allclose</code>.

<p>
We follow the convention that all tests are on the form
<code>assert success</code>, where <code>success</code> is a boolean expression
for the test. (The actual version of the test function in
the file <a href="http://tinyurl.com/pwyasaa/class/Polynomial.py" target="_self"><tt>Polynomial.py</tt></a>
adds an error message <code>msg</code> to the test:
<code>assert success, msg</code>.) Another part of the convention is
that the function starts with <code>test_</code> and the function takes no
arguments.

<p>
Our test function now becomes

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_Polynomial</span>():
    p1 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">1</span>, <span style="color: #666666">-1</span>])
    p2 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">-1</span>])

    p3 <span style="color: #666666">=</span> p1 <span style="color: #666666">+</span> p2
    p3_exact <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">-1</span>])
    <span style="color: #008000; font-weight: bold">assert</span> p3<span style="color: #666666">.</span>coeff <span style="color: #666666">==</span> p3_exact<span style="color: #666666">.</span>coeff

    p4 <span style="color: #666666">=</span> p1<span style="color: #666666">*</span>p2
    p4_exact <span style="color: #666666">=</span> Polynomial(numpy<span style="color: #666666">.</span>array([<span style="color: #666666">0</span>,  <span style="color: #666666">1</span>, <span style="color: #666666">-1</span>,  <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>,  <span style="color: #666666">5</span>,  <span style="color: #666666">1</span>]))
    <span style="color: #008000; font-weight: bold">assert</span> numpy<span style="color: #666666">.</span>allclose(p4<span style="color: #666666">.</span>coeff, p4_exact<span style="color: #666666">.</span>coeff, rtol<span style="color: #666666">=1E-14</span>)

    p5 <span style="color: #666666">=</span> p2<span style="color: #666666">.</span>derivative()
    p5_exact <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-24</span>, <span style="color: #666666">-5</span>])
    <span style="color: #008000; font-weight: bold">assert</span> p5<span style="color: #666666">.</span>coeff <span style="color: #666666">==</span> p5_exact<span style="color: #666666">.</span>coeff

    p6 <span style="color: #666666">=</span> Polynomial([<span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-6</span>, <span style="color: #666666">-1</span>])  <span style="color: #408080; font-style: italic"># p2</span>
    p6<span style="color: #666666">.</span>differentiate()
    p6_exact <span style="color: #666666">=</span> p5_exact
    <span style="color: #008000; font-weight: bold">assert</span> p6<span style="color: #666666">.</span>coeff <span style="color: #666666">==</span> p6_exact<span style="color: #666666">.</span>coeff
</pre></div>

<h2 id="sec:class:arithmetics" class="anchor">Arithmetic operations and other special methods</h2>

<p>
Given two instances <code>a</code> and <code>b</code>, the standard binary arithmetic
operations with <code>a</code> and <code>b</code> are defined by the following
special methods:

<ul>
  <li> <code>a + b</code> : <code>a.__add__(b)</code></li>
  <li> <code>a - b</code> : <code>a.__sub__(b)</code></li>
  <li> <code>a*b</code> : <code>a.__mul__(b)</code></li>
  <li> <code>a/b</code> : <code>a.__div__(b)</code></li>
  <li> <code>a**b</code> : <code>a.__pow__(b)</code></li>
</ul>

Some other special methods are also often useful:

<ul>
  <li> the length of <code>a</code>, <code>len(a)</code>: <code>a.__len__()</code></li>
  <li> the absolute value of <code>a</code>, <code>abs(a)</code>: <code>a.__abs__()</code></li>
  <li> <code>a == b</code> : <code>a.__eq__(b)</code></li>
  <li> <code>a &gt; b</code> : <code>a.__gt__(b)</code></li>
  <li> <code>a &gt;= b</code> : <code>a.__ge__(b)</code></li>
  <li> <code>a &lt; b</code> : <code>a.__lt__(b)</code></li>
  <li> <code>a &lt;= b</code> : <code>a.__le__(b)</code></li>
  <li> <code>a != b</code> : <code>a.__ne__(b)</code></li>
  <li> <code>-a</code> : <code>a.__neg__()</code></li>
  <li> evaluating <code>a</code> as a boolean expression (as in the test <code>if a:</code>) implies calling the special method <code>a.__bool__()</code>, which must return <code>True</code> or <code>False</code> - if <code>__bool__</code> is not defined, <code>__len__</code> is called to see if the length is zero (<code>False</code>) or not (<code>True</code>)</li>
</ul>

We can implement such methods in class <code>Polynomial</code>, see <a href="._class-bootstrap008.html#sec:class:ex6a">Exercise 25: Implement subtraction of polynomials</a>.  The section <a href="._class-bootstrap004.html#sec:class:Vec2D">Example: Class for vectors in the plane</a> contains
examples on implementing the special methods listed above.

<h2 id="sec:class:repr" class="anchor">Special methods for string conversion</h2>

<p>
Look at this class with a <code>__str__</code> method:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyClass</span>(<span style="color: #008000">object</span>):
<span style="color: #666666">...</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>):
<span style="color: #666666">...</span>         <span style="color: #008000">self</span><span style="color: #666666">.</span>data <span style="color: #666666">=</span> <span style="color: #666666">2</span>
<span style="color: #666666">...</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__str__</span>(<span style="color: #008000">self</span>):
<span style="color: #666666">...</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;In __str__: </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">str</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>data)
<span style="color: #666666">...</span>
<span style="color: #666666">&gt;&gt;&gt;</span> a <span style="color: #666666">=</span> MyClass()
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> a
In __str__: <span style="color: #666666">2</span>
</pre></div>
<p>
Hopefully, you understand well why we get this output (if not, go back to
the section <a href="#sec:class:str">Turning an instance into a string</a>).

<p>
But what will happen
if we write just <code>a</code> at the command prompt in an interactive shell?

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> a
<span style="color: #666666">&lt;</span>__main__<span style="color: #666666">.</span>MyClass instance at <span style="color: #666666">0xb75125ac&gt;</span>
</pre></div>
<p>
When writing just <code>a</code> in an interactive session,
Python looks for a special method
<code>__repr__</code> in <code>a</code>. This method is similar to
<code>__str__</code> in that it turns the instance into a string,
but there is a convention that <code>__str__</code> is a pretty print
of the instance contents while <code>__repr__</code> is a complete
representation of the contents of the instance. For a lot of
Python classes, including <code>int</code>, <code>float</code>, <code>complex</code>,
<code>list</code>, <code>tuple</code>, and <code>dict</code>, <code>__repr__</code>
and <code>__str__</code> give identical output. In our class <code>MyClass</code>
the <code>__repr__</code> is missing, and we need to add it if we want

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> a
</pre></div>
<p>
to write the contents like <code>print a</code> does.

<p>
Given an instance <code>a</code>, <code>str(a)</code> implies calling
<code>a.__str__()</code> and <code>repr(a)</code> implies calling
<code>a.__repr__()</code>. This means that

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> a
</pre></div>
<p>
is actually a <code>repr(a)</code> call and

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">print</span> a
</pre></div>
<p>
is actually a <code>print str(a)</code> statement.

<p>
A simple remedy in class <code>MyClass</code> is to define

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__repr__</span>(<span style="color: #008000">self</span>):
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>__str__()  <span style="color: #408080; font-style: italic"># or return str(self)</span>
</pre></div>
<p>
However, as we explain below, the <code>__repr__</code> is best defined
differently.

<h3 id="___sec48" class="anchor">Recreating objects from strings </h3>

<p>
The Python function <code>eval(e)</code> evaluates a valid Python expression
contained in the string
<code>e</code>.
It is a convention that <code>__repr__</code> returns a string such that
<code>eval</code> applied to the string recreates the instance.
For example, in case of the <code>Y</code> class
from the section <a href="._class-bootstrap001.html#sec:class:func2">Representing a function as a class</a>, <code>__repr__</code>
should return <code>'Y(10)'</code> if the <code>v0</code> variable has the value <code>10</code>.
Then <code>eval('Y(10)')</code> will be the same as if we had coded
<code>Y(10)</code> directly in the program or an interactive session.

<p>
Below we show examples of <code>__repr__</code> methods in classes <code>Y</code>
(the section <a href="._class-bootstrap001.html#sec:class:func2">Representing a function as a class</a>),
<code>Polynomial</code> (the section <a href="#sec:class:Polynomial">Example: Class for polynomials</a>),
and <code>MyClass</code> (above):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Y</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__repr__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;Y(v0=</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">)&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>v0

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Polynomial</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__repr__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;Polynomial(coefficients=</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">)&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>coeff

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyClass</span>(<span style="color: #008000">object</span>):
    <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__repr__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;MyClass()&#39;</span>
</pre></div>
<p>
With these definitions, <code>eval(repr(x))</code> recreates the object <code>x</code>
if it is of one of the three types above.
In particular, we can write <code>x</code> to file and later recreate the
<code>x</code> from the file information:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># somefile is some file object</span>
somefile<span style="color: #666666">.</span>write(<span style="color: #008000">repr</span>(x))
somefile<span style="color: #666666">.</span>close()
<span style="color: #666666">...</span>
data <span style="color: #666666">=</span> somefile<span style="color: #666666">.</span>readline()
x2 <span style="color: #666666">=</span> <span style="color: #008000">eval</span>(data)  <span style="color: #408080; font-style: italic"># recreate object</span>
</pre></div>
<p>
Now, <code>x2</code> will be equal to <code>x</code> (<code>x2 == x</code> evaluates to <code>True</code>).

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._class-bootstrap002.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._class-bootstrap004.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

