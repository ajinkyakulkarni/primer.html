<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Random numbers and simple games">
<meta name="keywords" content="random numbers,seed,uniformly distributed random numbers,random numbers uniform distribution,bin (histogram),histogram (normalized),random numbers histogram,vectorized drawing of random numbers,random numbers vectorization,mean,average,random numbers statistics,variance,standard deviation,mod function,normally distributed random numbers,random numbers normal distribution,random numbers integers,integer random numbers,probability,random numbers Monte Carlo simulation,Monte Carlo simulation,Monte Carlo integration,random numbers integration,Midpoint rule for integration,mod function,measure time in programs,efficiency measure,random walk,random numbers random walk,making movie,cumulative sum">

<title>Random numbers and simple games</title>


<link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/css/solarized_light_code.css" rel="stylesheet" type="text/css" title="light"/>
<script src="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="http://thomasf.github.io/solarized-css/solarized-light.min.css" rel="stylesheet">
<style type="text/css">
h1 {color: #b58900;}  /* yellow */
/* h1 {color: #cb4b16;}  orange */
/* h1 {color: #d33682;}  magenta, the original choice of thomasf */
code { padding: 0px; background-color: inherit; }
pre {
  border: 0pt solid #93a1a1;
  box-shadow: none;
}

div { text-align: justify; text-justify: inter-word; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Drawing random numbers', 1, None, '___sec0'),
              ('The seed', 2, None, '___sec1'),
              ('Uniformly distributed random numbers',
               2,
               'sec:random:uniform',
               'sec:random:uniform'),
              ('Visualizing the distribution', 2, None, '___sec3'),
              ('Vectorized drawing of random numbers', 2, None, '___sec4'),
              ('Warning', 3, None, '___sec5'),
              ('Computing the mean and standard deviation',
               2,
               'sec:random:statistics',
               'sec:random:statistics'),
              ('The Gaussian or normal distribution',
               2,
               'sec:random:normal',
               'sec:random:normal'),
              ('Drawing integers', 1, 'sec:random:ints', 'sec:random:ints'),
              ('Random integer functions', 2, None, '___sec9'),
              ('Example: Throwing a die', 2, None, '___sec10'),
              ('Scalar version', 3, None, '___sec11'),
              ('Vectorized version', 3, None, '___sec12'),
              ('Vectorized version with batches', 3, None, '___sec13'),
              ('Verification of the scalar version', 3, None, '___sec14'),
              ('Verification of all versions', 3, None, '___sec15'),
              ('Drawing a random element from a list', 2, None, '___sec16'),
              ('Example: Drawing cards from a deck',
               2,
               'sec:random:deck1',
               'sec:random:deck1'),
              ('Example: Class implementation of a deck',
               2,
               'sec:class:deck:class',
               'sec:class:deck:class'),
              ('Computing probabilities',
               1,
               'sec:random:probability',
               'sec:random:probability'),
              ('Principles of Monte Carlo simulation', 2, None, '___sec20'),
              ('Example: Throwing dice',
               2,
               'sec:random:probability:dice',
               'sec:random:probability:dice'),
              ('Straightforward solution', 3, None, '___sec22'),
              ('Vectorization', 3, None, '___sec23'),
              ('Exact solution', 3, None, '___sec24'),
              ('A game', 3, None, '___sec25'),
              ('Decide if a game is fair', 3, None, '___sec26'),
              ('Example: Drawing balls from a hat',
               2,
               'sec:random:balls',
               'sec:random:balls'),
              ('Random mutations of genes',
               2,
               'bioinf:random',
               'bioinf:random'),
              ('A simple mutation model', 3, None, '___sec29'),
              ('Vectorized version', 3, None, '___sec30'),
              ('A Markov chain mutation model', 3, None, '___sec31'),
              ('Example: Policies for limiting population growth',
               2,
               'sec:random:china',
               'sec:random:china'),
              ('Simple games', 1, None, '___sec33'),
              ('Guessing a number',
               2,
               'sec:random:game:guessn',
               'sec:random:game:guessn'),
              ('The game', 3, None, '___sec35'),
              ('The implementation', 3, None, '___sec36'),
              ('Rolling two dice',
               2,
               'sec:random:twodicesumguess',
               'sec:random:twodicesumguess'),
              ('The game', 3, None, '___sec38'),
              ('The implementation', 3, None, '___sec39'),
              ('Example', 3, None, '___sec40'),
              ('A class version', 3, None, '___sec41'),
              ('Monte Carlo integration',
               1,
               'sec:random:MonteCarlo:integration',
               'sec:random:MonteCarlo:integration'),
              ('Derivation of Monte Carlo integration',
               2,
               'sec:random:MCint:ideas',
               'sec:random:MCint:ideas'),
              ('The calculus approach via the mean-value theorem',
               3,
               None,
               '___sec44'),
              ('The probability theory approach', 3, None, '___sec45'),
              ('Implementation of standard Monte Carlo integration',
               2,
               'sec:random:MCint:std',
               'sec:random:MCint:std'),
              ('Example', 3, None, '___sec47'),
              ('Remark', 3, None, '___sec48'),
              ('Area computing by throwing random points',
               2,
               'sec:random:MCdart',
               'sec:random:MCdart'),
              ('Random walk in one space dimension',
               1,
               'sec:random:rw1D',
               'sec:random:rw1D'),
              ('Basic implementation', 2, None, '___sec51'),
              ('Visualization', 2, None, '___sec52'),
              ('Random walk as a difference equation', 2, None, '___sec53'),
              ('Computing statistics of the particle positions',
               2,
               'sec:random:walk:1D:statistics',
               'sec:random:walk:1D:statistics'),
              ('Vectorized implementation',
               2,
               'sec:random:walk:1D:vectorized',
               'sec:random:walk:1D:vectorized'),
              ('Random walk in two space dimensions',
               1,
               'sec:random:rw2D',
               'sec:random:rw2D'),
              ('Basic implementation',
               2,
               'sec:random:rw2D:scalar',
               'sec:random:rw2D:scalar'),
              ('Vectorized implementation',
               2,
               'sec:random:walk:2D:vectorized',
               'sec:random:walk:2D:vectorized'),
              ('Summary', 1, None, '___sec59'),
              ('Chapter topics', 2, None, '___sec60'),
              ('Drawing random numbers', 3, None, '___sec61'),
              ('Typical probability computation via Monte Carlo simulation',
               3,
               None,
               '___sec62'),
              ('Statistical measures', 3, None, '___sec63'),
              ('Terminology', 3, None, '___sec64'),
              ('Example: Random growth',
               2,
               'sec:random:summarizingex',
               'sec:random:summarizingex'),
              ('Problem', 3, None, '___sec66'),
              ('Solution', 3, None, '___sec67'),
              ('Exercises', 1, None, '___sec68'),
              ('Exercise 1: Flip a coin times',
               2,
               'sec:random:ex17',
               'sec:random:ex17'),
              ('Exercise 2: Compute a probability',
               2,
               'sec:random:ex7',
               'sec:random:ex7'),
              ('Exercise 3: Choose random colors',
               2,
               'sec:random:ex6',
               'sec:random:ex6'),
              ('Exercise 4: Draw balls from a hat',
               2,
               'sec:random:ex4',
               'sec:random:ex4'),
              ('Exercise 5: Computing probabilities of rolling dice',
               2,
               'sec:random:ex2',
               'sec:random:ex2'),
              ('Exercise 6: Estimate the probability in a dice game',
               2,
               'sec:random:ex10',
               'sec:random:ex10'),
              ('Exercise 7: Compute the probability of hands of cards',
               2,
               'sec:random:ex44',
               'sec:random:ex44'),
              ('Exercise 8: Decide if a dice game is fair',
               2,
               'sec:random:ex11',
               'sec:random:ex11'),
              ('Exercise 9: Adjust a game to make it fair',
               2,
               'sec:random:ex12',
               'sec:random:ex12'),
              ('Exercise 10: Generalize a game',
               2,
               'sec:random:ex12b',
               'sec:random:ex12b'),
              ('Exercise 11: Compare two playing strategies',
               2,
               'sec:random:ex2c',
               'sec:random:ex2c'),
              ('Exercise 12: Investigate strategies in a game',
               2,
               'sec:random:ex2e',
               'sec:random:ex2e'),
              ('Exercise 13: Investigate the winning chances of some games',
               2,
               'sec:random:ex45',
               'sec:random:ex45'),
              ('Exercise 14: Compute probabilities of throwing two dice',
               2,
               'sec:random:ex2b',
               'sec:random:ex2b'),
              ('Exercise 15: Vectorize flipping a coin',
               2,
               'sec:random:ex18',
               'sec:random:ex18'),
              ('Exercise 16: Vectorize a probablility computation',
               2,
               'sec:random:ex7b',
               'sec:random:ex7b'),
              ('Exercise 17: Throw dice and compute a small probability',
               2,
               'sec:random:ex30',
               'sec:random:ex30'),
              ('Exercise 18: Difference equation for random numbers',
               2,
               'sec:random:ex27',
               'sec:random:ex27'),
              ('Exercise 19: Make a class for drawing balls from a hat',
               2,
               'sec:random:ex9',
               'sec:random:ex9'),
              ('Exercise 20: Independent  versus dependent random numbers',
               2,
               'sec:random:ex21',
               'sec:random:ex21'),
              ('Exercise 21: Compute the probability of flipping a coin',
               2,
               'sec:random:ex19',
               'sec:random:ex19'),
              ('Exercise 22: Simulate a poker game',
               2,
               'sec:random:ex41',
               'sec:random:ex41'),
              ('Exercise 23: Estimate growth in a simulation model',
               2,
               'sec:random:ex29',
               'sec:random:ex29'),
              ('Exercise 24: Investigate guessing strategies',
               2,
               'sec:random:ex15',
               'sec:random:ex15'),
              ('Exercise 25: Vectorize a dice game',
               2,
               'sec:random:ex13',
               'sec:random:ex13'),
              ('Exercise 26: Compute $\\pi$ by a Monte Carlo method',
               2,
               'sec:random:ex31',
               'sec:random:ex31'),
              ('Exercise 27: Compute $\\pi$ by a Monte Carlo method',
               2,
               'sec:random:ex32',
               'sec:random:ex32'),
              ('Exercise 28: Compute $\\pi$ by a random sum',
               2,
               'sec:random:ex31b',
               'sec:random:ex31b'),
              ('Exercise 29: 1D random walk with drift',
               2,
               'sec:random:ex1',
               'sec:random:ex1'),
              ('Exercise 30: 1D random walk until a point is hit',
               2,
               'sec:random:ex3',
               'sec:random:ex3'),
              ('Exercise 31: Simulate making a fortune from gaming',
               2,
               'sec:random:ex3:rwgame',
               'sec:random:ex3:rwgame'),
              ('Exercise 32: Make classes for 2D random walk',
               2,
               'sec:random:ex33',
               'sec:random:ex33'),
              ('Exercise 33: 2D random walk with walls; scalar version',
               2,
               'sec:random:ex36',
               'sec:random:ex36'),
              ('Exercise 34: 2D random walk with walls; vectorized version',
               2,
               'sec:random:ex37',
               'sec:random:ex37'),
              ('Exercise 35: Simulate mixing of gas molecules',
               2,
               'sec:random:ex38',
               'sec:random:ex38'),
              ('Remarks', 3, None, '___sec104'),
              ('Exercise 36: Simulate slow mixing of gas molecules',
               2,
               'sec:random:ex39',
               'sec:random:ex39'),
              ('Exercise 37: Guess beer brands',
               2,
               'sec:random:ex35',
               'sec:random:ex35'),
              ('Exercise 38: Simulate stock prices',
               2,
               'sec:random:ex26',
               'sec:random:ex26'),
              ('Exercise 39: Compute with option prices in finance',
               2,
               'sec:random:ex16',
               'sec:random:ex16'),
              ('Remarks', 3, None, '___sec109'),
              ('Exercise 40: Differentiate noise measurements',
               2,
               'sec:random:ex22',
               'sec:random:ex22'),
              ('Exercise 41: Differentiate noisy signals',
               2,
               'sec:random:ex25',
               'sec:random:ex25'),
              ('Exercise 42: Model noise in a time signal',
               2,
               'sec:random:ex23',
               'sec:random:ex23'),
              ('Exercise 43: Speed up Markov chain mutation',
               2,
               'bioinf:exer:Markov:chain:eff',
               'bioinf:exer:Markov:chain:eff'),
              ('References', 1, None, '___sec114')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\tp}{\thinspace .}
\newcommand{\Prob}[1]{\hbox{P}(#1)}
$$




    
<a name="part0006"></a>
<p>
<!-- begin top navigation -->
<table style="width: 100%"><tr><td>
<div style="text-align: left;"><a href="._random-solarized005.html">&laquo; Previous</a></div>
</td><td>
<div style="text-align: right;"><a href="._random-solarized007.html">Next &raquo;</a></div>
</td></tr></table>
<!-- end top navigation -->
</p>

<p>
<!-- !split -->
<p style="font-size:80%">This chapter is taken from book <a href="http://www.springer.com/gp/book/9783642549588">A Primer on Scientific Programming with Python</a> by H. P. Langtangen, 4th edition, Springer, 2014.</p>

<h1 id="sec:random:rw2D">Random walk in two space dimensions</h1>

<p>
A random walk in two dimensions performs a step either to the north,
south, west, or east, each one with probability \( 1/4 \).
To demonstrate this process,
we introduce \( x \) and \( y \) coordinates of \( n_p \) particles and
draw random numbers among 1, 2, 3, or 4
to determine the move.
The positions of the particles can easily
be visualized as small circles in an \( xy \) coordinate system.

<h2 id="sec:random:rw2D:scalar">Basic implementation</h2>

<p>
The algorithm described above
is conveniently expressed directly as a complete working program:

<p>
<!-- begin verbatim block  pypro-->
<pre><code>def random_walk_2D(np, ns, plot_step):
    xpositions = numpy.zeros(np)
    ypositions = numpy.zeros(np)
    # extent of the axis in the plot:
    xymax = 3*numpy.sqrt(ns); xymin = -xymax

    NORTH = 1;  SOUTH = 2;  WEST = 3;  EAST = 4  # constants

    for step in range(ns):
        for i in range(np):
            direction = random.randint(1, 4)
            if direction == NORTH:
                ypositions[i] += 1
            elif direction == SOUTH:
                ypositions[i] -= 1
            elif direction == EAST:
                xpositions[i] += 1
            elif direction == WEST:
                xpositions[i] -= 1

        # Plot just every plot_step steps
        if (step+1) % plot_step == 0:
            plot(xpositions, ypositions, 'ko',
                 axis=[xymin, xymax, xymin, xymax],
                 title='%d particles after %d steps' % 
                       (np, step+1),
                 savefig='tmp_%03d.pdf' % (step+1))
    return xpositions, ypositions

# main program:
import random
random.seed(10)
import sys
import numpy
from scitools.std import plot

np        = int(sys.argv[1])  # number of particles
ns        = int(sys.argv[2])  # number of steps
plot_step = int(sys.argv[3])  # plot every plot_step steps
x, y = random_walk_2D(np, ns, plot_step)
</code></pre>
<!-- end verbatim block -->
The program is found in the file <a href="http://tinyurl.com/pwyasaa/random/walk2D.py" target="_self"><tt>walk2D.py</tt></a>.  Figure
<a href="#fig:random:walk:2D:particles">7</a> shows two snapshots of the
distribution of 3000 particles after 40 and 400 steps.  These plots
were generated with command-line arguments <code>3000 400 20</code>, the latter
implying that we visualize the particles every 20 time steps only.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 7:  Location of 3000 particles starting at the origin and performing a random walk, with 40 steps (left) and 400 steps (right). <div id="fig:random:walk:2D:particles"></div> </p></center>
<p><img src="fig-random/randomwalk2D.png" align="bottom" width=400></p>
</center>

<p>
To get a feeling for the two-dimensional random walk you can try out
only 30 particles for 400 steps and let each step be visualized
(i.e., command-line arguments <code>30 400 1</code>).
The update of the movements is now fast.

<p>
The <code>walk2D.py</code> program dumps the plots to PDF files
with names of the form <code>tmp_xxx.pdf</code>, where <code>xxx</code> is
the step number. We can create a movie out of these individual
files using the program <code>convert</code> from the ImageMagick suite:

<p>
<!-- begin verbatim block  sys-->
<pre><code>Terminal&gt; convert -delay 50 -loop 1000 tmp_*.pdf movie.gif
</code></pre>
<!-- end verbatim block -->
All the plots are now put after each other as frames in a movie, with
a delay of 50 ms between each frame. The movie will run in a loop
1000 times.
The resulting movie file is named <code>movie.gif</code>, which can
be viewed by the <code>animate</code> program (also from the ImageMagick
program suite), just write <code>animate movie.gif</code>.
Making and showing the movie are slow processes if a large number of
steps are included in the movie. The alternative is to make
a true video file in, e.g., the Flash format:

<p>
<!-- begin verbatim block  sys-->
<pre><code>Terminal&gt; avconv -r 5 -i tmp_%04d.png -c:v flv movie.flv
</code></pre>
<!-- end verbatim block -->
This requires the plot files to be in PNG format.

<h2 id="sec:random:walk:2D:vectorized">Vectorized implementation</h2>

<p>
The <code>walk2D.py</code> program is quite slow. Now the visualization is much
faster than the movement of the particles.  Vectorization may speed up
the <code>walk2D.py</code> program significantly.  As in the one-dimensional
phase, we draw all the movements at once and then invoke a loop over
the steps to update the \( x \) and \( y \) coordinates.  We draw \( n_s\times
n_p \) numbers among 1, 2, 3, and 4.  We then reshape the vector of
random numbers to a two-dimensional array <code>moves[i, j]</code>, where <code>i</code>
counts the steps, <code>j</code> counts the particles.  The <code>if</code> test on whether
the current move is to the north, south, east, or west can be
vectorized using the <code>where</code>
function.
For example, if the random numbers for all particles in the current step
are accessible in an array <code>this_move</code>, we could update the \( x \)
positions by

<p>
<!-- begin verbatim block  pycod-->
<pre><code>xpositions += np.where(this_move == EAST, 1, 0)
xpositions -= np.where(this_move == WEST, 1, 0)
</code></pre>
<!-- end verbatim block -->
provided <code>EAST</code> and <code>WEST</code> are constants, equal to 3 and 4,
respectively. A similar construction can be used for the \( y \) moves.

<p>
The complete program is listed below:

<p>
<!-- begin verbatim block  pypro-->
<pre><code>def random_walk_2D(np, ns, plot_step):
    xpositions = numpy.zeros(np)
    ypositions = numpy.zeros(np)
    moves = numpy.random.random_integers(1, 4, size=ns*np)
    moves.shape = (ns, np)

    # Estimate max and min positions
    xymax = 3*numpy.sqrt(ns); xymin = -xymax

    NORTH = 1;  SOUTH = 2;  WEST = 3;  EAST = 4  # constants

    for step in range(ns):
        this_move = moves[step,:]
        ypositions += numpy.where(this_move == NORTH, 1, 0)
        ypositions -= numpy.where(this_move == SOUTH, 1, 0)
        xpositions += numpy.where(this_move == EAST,  1, 0)
        xpositions -= numpy.where(this_move == WEST,  1, 0)

        # Just plot every plot_step steps
        if (step+1) % plot_step == 0:
            plot(xpositions, ypositions, 'ko',
                 axis=[xymin, xymax, xymin, xymax],
                 title='%d particles after %d steps' % 
                       (np, step+1),
                 savefig='tmp_%03d.pdf' % (step+1))
    return xpositions, ypositions

# Main program
from scitools.std import plot
import numpy, sys
numpy.random.seed(11)

np = int(sys.argv[1])  # number of particles
ns = int(sys.argv[2])  # number of steps
plot_step = int(sys.argv[3])  # plot each plot_step step
x, y = random_walk_2D(np, ns, plot_step)
</code></pre>
<!-- end verbatim block -->
You will easily experience that this program, found in the file
<a href="http://tinyurl.com/pwyasaa/random/walk2Dc.py" target="_self"><tt>walk2Dv.py</tt></a>, runs significantly
faster than the <code>walk2D.py</code> program.

<p>
<p>
<!-- begin bottom navigation -->
<table style="width: 100%"><tr><td>
<div style="text-align: left;"><a href="._random-solarized005.html">&laquo; Previous</a></div>
</td><td>
<div style="text-align: right;"><a href="._random-solarized007.html">Next &raquo;</a></div>
</td></tr></table>
<!-- end bottom navigation -->
</p>

<!-- ------------------- end of main content --------------- -->


</body>
</html>
    

