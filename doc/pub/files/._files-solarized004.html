<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Dictionaries and strings">
<meta name="keywords" content="dictionary,keys (dictionaries),immutable objects,mutable objects,dictionary comprehensions,nested dictionaries,dictionary nested,date conversion,plotting data vs date,string slicing,slicing,substrings,string substrings,string searching,string substitution,substitution (in text),string splitting,string case change,string testing for number,whitespace,blank lines in files,string stripping leading/trailing blanks,string joining list elements,dictionary functionality">

<title>Dictionaries and strings</title>


<link href="https://raw.githubusercontent.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/css/solarized_light_code.css" rel="stylesheet" type="text/css" title="light"/>
<script src="https://rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="http://thomasf.github.io/solarized-css/solarized-light.min.css" rel="stylesheet">
<style type="text/css">
h1 {color: #b58900;}  /* yellow */
/* h1 {color: #cb4b16;}  orange */
/* h1 {color: #d33682;}  magenta, the original choice of thomasf */
code { padding: 0px; background-color: inherit; }
pre {
  border: 0pt solid #93a1a1;
  box-shadow: none;
}

div { text-align: justify; text-justify: inter-word; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [(u' Dictionaries ', 1, u'sec:files:dicts', u'sec:files:dicts'),
              (u' Making dictionaries ', 2, None, '___sec1'),
              (u' Dictionary operations ', 2, None, '___sec2'),
              (u' Remark ', 3, None, '___sec3'),
              (u' Example: Polynomials as dictionaries ',
               2,
               u'sec:files:poly',
               u'sec:files:poly'),
              (u' Dictionaries with default values and ordering ',
               2,
               u'sec:files:dict:default:order',
               u'sec:files:dict:default:order'),
              (u' Dictionaries with default values ', 3, None, '___sec6'),
              (u' Ordered dictionaries ', 3, None, '___sec7'),
              (u' Example: File data in dictionaries ',
               2,
               u'sec:files:dict:density',
               u'sec:files:dict:density'),
              (u' Problem ', 3, None, '___sec9'),
              (u' Solution ', 3, None, '___sec10'),
              (u' Example: File data in nested dictionaries ',
               2,
               u'sec:files:dictdict',
               u'sec:files:dictdict'),
              (u' Problem ', 3, None, '___sec12'),
              (u' Algorithm ', 3, None, '___sec13'),
              (u' Implementation ', 3, None, '___sec14'),
              (u' Dissection ', 3, None, '___sec15'),
              (u' Example: Reading and plotting data recorded at specific dates ',
               2,
               u'sec:files:stockprices',
               u'sec:files:stockprices'),
              (u' Problem ', 3, None, '___sec17'),
              (u' Solution ', 3, None, '___sec18'),
              (u' Strings ', 1, u'sec:files:str', u'sec:files:str'),
              (u' Common operations on strings ',
               2,
               u'sec:files:stringop',
               u'sec:files:stringop'),
              (u' Substring specification ', 3, None, '___sec21'),
              (u' Searching for substrings ', 3, None, '___sec22'),
              (u' Substitution ', 3, None, '___sec23'),
              (u' String splitting ', 3, None, '___sec24'),
              (u' Upper and lower case ', 3, None, '___sec25'),
              (u' Strings are constant ', 3, None, '___sec26'),
              (u' Strings with digits only ', 3, None, '___sec27'),
              (u' Whitespace ', 3, None, '___sec28'),
              (u' Joining strings ', 3, None, '___sec29'),
              (u' Example: Reading pairs of numbers ',
               2,
               u'sec:files:pairs',
               u'sec:files:pairs'),
              (u' Problem ', 3, None, '___sec31'),
              (u' Solution ', 3, None, '___sec32'),
              (u' Example: Reading coordinates ', 2, None, '___sec33'),
              (u' Problem ', 3, None, '___sec34'),
              (u' Solution 1: substring extraction ', 3, None, '___sec35'),
              (u' Solution 2: string search ', 3, None, '___sec36'),
              (u' Solution 3: string split ', 3, None, '___sec37'),
              (u' Reading data from web pages ',
               1,
               u'sec:files:webtxt',
               u'sec:files:webtxt'),
              (u' About web pages ',
               2,
               u'sec:files:HTMLintro',
               u'sec:files:HTMLintro'),
              (u' How to access web pages in programs ',
               2,
               u'sec:files:urllib',
               u'sec:files:urllib'),
              (u' Alternative 1 ', 3, None, '___sec41'),
              (u' Alternative 2 ', 3, None, '___sec42'),
              (u' Example: Reading pure text files ',
               2,
               u'sec:files:url:weather',
               u'sec:files:url:weather'),
              (u' Example: Extracting data from HTML ',
               2,
               u'sec:files:url:interpret',
               u'sec:files:url:interpret'),
              (u' Handling non-English text ',
               2,
               u'sec:files:encoding',
               u'sec:files:encoding'),
              (u' Reading and writing spreadsheet files ',
               1,
               u'sec:files:csv',
               u'sec:files:csv'),
              (u' CSV files ', 2, None, '___sec47'),
              (u' Reading CSV files ', 2, None, '___sec48'),
              (u' Processing spreadsheet data ', 2, None, '___sec49'),
              (u' Writing CSV files ', 2, None, '___sec50'),
              (u' Remark ', 3, None, '___sec51'),
              (u' Representing number cells with Numerical Python arrays ',
               2,
               None,
               '___sec52'),
              (u' Using more high-level Numerical Python functionality ',
               2,
               None,
               '___sec53'),
              (u' Summary ', 1, None, '___sec54'),
              (u' Chapter topics ', 2, None, '___sec55'),
              (u' Dictionaries ', 3, None, '___sec56'),
              (u' Strings ', 3, None, '___sec57'),
              (u' Downloading Internet files ', 3, None, '___sec58'),
              (u' Terminology ', 3, None, '___sec59'),
              (u' Example: A file database ',
               2,
               u'sec:files:sumex',
               u'sec:files:sumex'),
              (u' Problem ', 3, None, '___sec61'),
              (u' Solution ', 3, None, '___sec62'),
              (u' Exercises ',
               1,
               u'sec:files:exercises',
               u'sec:files:exercises'),
              (u' Exercise 1: Make a dictionary from a table ',
               2,
               u'sec:files:ex2b:basic',
               u'sec:files:ex2b:basic'),
              (u' Exercise 2: Explore syntax differences: lists vs. dicts ',
               2,
               u'sec:files:ex2',
               u'sec:files:ex2'),
              (u' Exercise 3: Use string operations to improve a program ',
               2,
               u'sec:files:ex17',
               u'sec:files:ex17'),
              (u' Exercise 4: Interpret output from a program ',
               2,
               u'sec:files:ex13',
               u'sec:files:ex13'),
              (u' Exercise 5: Make a nested dictionary from a file ',
               2,
               u'sec:files:ex2d:nested',
               u'sec:files:ex2d:nested'),
              (u' Exercise 6: Make a nested dictionary from a file ',
               2,
               u'sec:files:ex2d:nested2',
               u'sec:files:ex2d:nested2'),
              (u' Exercise 7: Compare data structures for polynomials ',
               2,
               u'sec:files:ex16',
               u'sec:files:ex16'),
              (u' Exercise 8: Compute the derivative of a polynomial ',
               2,
               u'sec:files:ex3',
               u'sec:files:ex3'),
              (u' Exercise 9: Specify functions on the command line ',
               2,
               u'sec:basic:ex10',
               u'sec:basic:ex10'),
              (u' Exercise 10: Interpret function specifications ',
               2,
               u'sec:basic:ex10b',
               u'sec:basic:ex10b'),
              (u' Exercise 11: Compare average temperatures in cities ',
               2,
               u'sec:files:ex8',
               u'sec:files:ex8'),
              (u' References ', 1, None, '___sec75')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\tp}{\thinspace .}
$$




    
<a name="part0004"></a>
<p>
<!-- begin top navigation -->
<table style="width: 100%"><tr><td>
<div style="text-align: left;"><a href="._files-solarized003.html">&laquo; Previous</a></div>
</td><td>
<div style="text-align: right;"><a href="._files-solarized005.html">Next &raquo;</a></div>
</td></tr></table>
<!-- end top navigation -->
</p>

<p>
<!-- !split -->

<h1>Reading and writing spreadsheet files <a name="sec:files:csv"></a></h1>

<p>
From school you are probably used to spreadsheet programs such as
Microsoft Excel or LibreOffice. This type of program is used to represent
a table of numbers and text. Each table entry is known as a <em>cell</em>,
and one can easily perform calculations with cells that contain numbers.
The application of spreadsheet programs for mathematical computations
and graphics is steadily growing.

<p>
Also Python may be used to do spreadsheet-type calculations on tabular
data.  The advantage of using Python is that you can easily extend the
calculations far beyond what a spreadsheet program can do. However,
even if you can view Python as a substitute for a spreadsheet program,
it may be beneficial to combine the two. Suppose you have some data in
a spreadsheet. How can you read these data into a Python program,
perform calculations on the data, and thereafter read the data back to
the spreadsheet program? This is exactly what we will explain below
through an example. With this example, you should understand how easy
it is to combine Excel or LibreOffice with your own Python programs.

<h2>CSV files  <a name="___sec47"></a></h2>

<p>
The table of data in a spreadsheet can be saved in so-called CSV files,
where CSV stands for <em>comma separated values</em>.
The CSV file format is very simple:
each row in the spreadsheet table is a line in the file, and each cell
in the row is separated by a comma or some other specified
separation character.
CSV files can easily be read into Python programs, and the
table of
cell data can be stored in a nested list
(table),
which can be processed as we desire.
The modified table of cell data can be written back to a CSV file and read into
the spreadsheet program for further processing.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 5:  A simple spreadsheet in LibreOffice. <a name="sec:io:fig1"></a> </p></center>
<p><img src="fig-files/spreadsheet1.png" align="bottom" width=400></p>
</center>

<p>
Figure <a href="#sec:io:fig1">5</a> shows a simple
spreadsheet in the LibreOffice program. The table contains \( 4\times 4 \)
cells, where the first row contains column headings and the first column contains
row headings. The remaining \( 3\times 3 \) subtable contains numbers that
we may compute with.
Let us save this spreadsheet to a file in the CSV format.
The complete file will typically look as follows:

<p>
<!-- begin verbatim block  txt-->
<pre><code>,&quot;year 1&quot;,&quot;year 2&quot;,&quot;year 3&quot;
&quot;person 1&quot;,651000,651000,651000
&quot;person 2&quot;,1100500,950100,340000
&quot;person 3&quot;,740000,780000,800000
</code></pre>
<!-- end verbatim block -->

<p>
Our primary task is now to load these data into a Python program,
compute the sum of each column, and write the data out again in the
CSV format.

<h2>Reading CSV files  <a name="___sec48"></a></h2>

<p>
We start with loading the data into a table, represented as
a nested list, with aid of the
<code>csv</code> module from Python's standard library.
This approach gives us complete control of all
details. Later, we will use more high-level <code>numpy</code> functionality
for accomplishing the same thing with less lines.

<p>
The <code>csv</code> module offers functionality for reading one line at a time
from a CSV file:

<p>
<!-- begin verbatim block  pycod-->
<pre><code>infile = open('budget.csv', 'r')  # CSV file
import csv
table = []
for row in csv.reader(infile):
    table.append(row)
infile.close()
</code></pre>
<!-- end verbatim block -->
The <code>row</code> variable is a list of column values that are
read from the file by the <code>csv</code> module.
The three lines computing <code>table</code> can be condensed to one using
a list comprehension:

<p>
<!-- begin verbatim block  pycod-->
<pre><code>table = [row for row in csv.reader(infile)]
</code></pre>
<!-- end verbatim block -->
We can easily print <code>table</code>,

<p>
<!-- begin verbatim block  pycod-->
<pre><code>import pprint
pprint.pprint(table)
</code></pre>
<!-- end verbatim block -->
to see what the spreadsheet looks like
when it is represented as a nested list in a Python program:

<p>
<!-- begin verbatim block  ccq-->
<pre><code>[['', 'year 1', 'year 2', 'year 3'],
 ['person 1', '651000', '651000', '651000'],
 ['person 2', '1100500', '950100', '340000'],
 ['person 3', '740000', '780000', '800000']]
</code></pre>
<!-- end verbatim block -->
Observe now that all entries are surrounded by quotes, which means that
all entries are string (<code>str</code>) objects. This is a general rule:
the <code>csv</code> module reads all cells into string objects.
To compute with the numbers, we need to transform the string objects
to <code>float</code> objects. The transformation
should not be applied to the first row and first column, since the
cells here hold text.
The transformation from strings to numbers
therefore applies to the indices <code>r</code> and <code>c</code>
in <code>table</code> (<code>table[r][c]</code>), such that the row counter
<code>r</code> goes from 1 to <code>len(table)-1</code>,
and the column counter <code>c</code>
goes from 1 to <code>len(table[0])-1</code> (<code>len(table[0])</code> is
the length of the first row, assuming the lengths of all rows are
equal to the length of the first row).
The relevant Python code for this transformation task becomes

<p>
<!-- begin verbatim block  pycod-->
<pre><code> for r in range(1,len(table)):
    for c in range(1, len(table[0])):
        table[r][c] = float(table[r][c])
</code></pre>
<!-- end verbatim block -->
A <code>pprint.pprint(table)</code> statement after this transformation yields

<p>
<!-- begin verbatim block  ccq-->
<pre><code>[['', 'year 1', 'year 2', 'year 3'],
 ['person 1', 651000.0, 651000.0, 651000.0],
 ['person 2', 1100500.0, 950100.0, 340000.0],
 ['person 3', 740000.0, 780000.0, 800000.0]]
</code></pre>
<!-- end verbatim block -->
The numbers now have a decimal and no quotes, indicating
that the numbers are <code>float</code> objects and hence ready for mathematical
calculations.

<h2>Processing spreadsheet data  <a name="___sec49"></a></h2>

<p>
Let us perform a very simple calculation with <code>table</code>,
namely adding a final row
with the sum of the numbers in the columns:

<p>
<!-- begin verbatim block  pycod-->
<pre><code>row = [0.0]*len(table[0])
row[0] = 'sum'
for c in range(1, len(row)):
    s = 0
    for r in range(1, len(table)):
        s += table[r][c]
    row[c] = s
</code></pre>
<!-- end verbatim block -->
As seen, we first create a list <code>row</code> consisting of zeros.
Then we insert a text in the first column, before we invoke a
loop over the numbers in the table and compute the sum of each column.
The <code>table</code> list now represents a spreadsheet with four columns and
five rows:

<p>
<!-- begin verbatim block  ccq-->
<pre><code>[['', 'year 1', 'year 2', 'year 3'],
 ['person 1', 651000.0, 651000.0, 651000.0],
 ['person 2', 1100500.0, 950100.0, 340000.0],
 ['person 3', 740000.0, 780000.0, 800000.0],
 ['sum', 2491500.0, 2381100.0, 1791000.0]]
</code></pre>
<!-- end verbatim block -->

<h2>Writing CSV files  <a name="___sec50"></a></h2>

<p>
Our final task is to write the modified <code>table</code> list
back to a CSV file so that the data can be loaded in a spreadsheet program.
The write task is done by the code segment

<p>
<!-- begin verbatim block  pycod-->
<pre><code>outfile = open('budget2.csv', 'w')
writer = csv.writer(outfile)
for row in table:
    writer.writerow(row)
outfile.close()
</code></pre>
<!-- end verbatim block -->
The <code>budget2.csv</code> looks like this:

<p>
<!-- begin verbatim block  txt-->
<pre><code>year 1,year 2,year 3
person 1,651000.0,651000.0,651000.0
person 2,1100500.0,950100.0,340000.0
person 3,740000.0,780000.0,800000.0
sum,2491500.0,2381100.0,1791000.0
</code></pre>
<!-- end verbatim block -->

<p>
The final step is to read <code>budget2.csv</code> into a spreadsheet.
The result is displayed in Figure <a href="#sec:io:fig2">6</a>
(in LibreOffice one must specify in the <em>Open</em> dialog that
the spreadsheet data are separated by commas, i.e., that the file
is in CSV format).

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 6:  A spreadsheet processed in a Python program and loaded back into LibreOffice. <a name="sec:io:fig2"></a> </p></center>
<p><img src="fig-files/spreadsheet2.png" align="bottom" width=400></p>
</center>

<p>
The complete program reading the <code>budget.csv</code> file, processing its
data, and writing the <code>budget2.csv</code> file can be found in
<a href="http://tinyurl.com/pwyasaa/files/rw_csw.py" target="_self"><tt>rw_csv.py</tt></a>.  With this example at
hand, you should be in a good position to combine spreadsheet programs
with your own Python programs.

<h3>Remark  <a name="___sec51"></a></h3>

<p>
You may wonder why we used the <code>csv</code> module to read and write CSV
files when such files have comma separated values, which we can
extract by splitting lines with respect to the comma (this technique
is used in the section <a href="._files-solarized001.html#sec:files:stockprices">Example: Reading and plotting data recorded at specific dates</a> to read a CSV file):

<p>
<!-- begin verbatim block  pycod-->
<pre><code>infile = open('budget.csv', 'r')
for line in infile:
    row = line.split(',')
</code></pre>
<!-- end verbatim block -->
This works well for the present <code>budget.csv</code> file, but the technique
breaks down when a text in a cell contains a comma, for instance
<code>&quot;Aug 8, 2007&quot;</code>. The <code>line.split(',')</code> will split this cell text, while
the <code>csv.reader</code> functionality is smart enough to avoid splitting
text cells with a comma.

<h2>Representing number cells with Numerical Python arrays  <a name="___sec52"></a></h2>

<p>
Instead of putting the whole spreadsheet into a single nested list,
we can make a Python data structure more tailored to the data at hand.
What we have are two headers (for rows and columns, respectively) and
a subtable of numbers. The headers can be represented as lists of strings,
while the subtable could be a two-dimensional Numerical Python array.
The latter makes it easier to implement various mathematical operations
on the numbers. A dictionary can hold all the three items: two header
lists and one array. The relevant code for reading, processing, and
writing the data is shown below and can be found in the file
<a href="http://tinyurl.com/pwyasaa/files/rw_csv_numpy.py" target="_self"><tt>rw_csv_numpy.py</tt></a>:

<p>
<!-- begin verbatim block  pypro-->
<pre><code>infile = open('budget.csv', 'r')
import csv
table = [row for row in csv.reader(infile)]
infile.close()

# Convert subtable of numbers (string to float)
import numpy
subtable = [[float(c) for c in row[1:]] for row in table[1:]]

data = {'column headings': table[0][1:],
        'row headings': [row[0] for row in table[1:]],
        'array': numpy.array(subtable)}

# Add a new row with sums
data['row headings'].append('sum')
a = data['array']   # short form
data['column sum'] = [sum(a[:,c]) for c in range(a.shape[1])]

outfile = open('budget2.csv', 'w')
writer = csv.writer(outfile)
# Turn data dictionary into a nested list first (for easy writing)
table = a.tolist()   # transform array to nested list
table.append(data['column sum'])
table.insert(0, data['column headings'])
# Extend table with row headings (a new column)
[table[r+1].insert(0, data['row headings'][r])
 for r in range(len(table)-1)]
for row in table:
    writer.writerow(row)
outfile.close()
</code></pre>
<!-- end verbatim block -->
The code makes heavy use of list comprehensions, and the
transformation between a nested list, for file reading and writing,
and the <code>data</code> dictionary, for representing the data in the
Python program, is non-trivial. If you manage to understand every
line in this program, you have digested a lot of topics in
Python programming!

<h2>Using more high-level Numerical Python functionality  <a name="___sec53"></a></h2>

<p>
The previous program can be shortened significantly by applying
the <code>genfromtxt</code> function from Numerical Python:

<p>
<!-- begin verbatim block  pycod-->
<pre><code>import numpy as np
arr = np.genfromtxt('budget.csv', delimiter=',', dtype=str)

data = {'column headings': arr[0,1:].tolist(),
        'row headings': arr[1:,0].tolist(),
        'array': np.asarray(arr[1:,1:], dtype=np.float)}

data['row headings'].append('sum')
data['column sum'] = np.sum(data['array'], axis=1).tolist()
</code></pre>
<!-- end verbatim block -->
Doing a <code>repr(arr)</code> on the array returned from <code>genfromtxt</code>
results in

<p>
<!-- begin verbatim block  dat-->
<pre><code>array([['', '&quot;year 1&quot;', '&quot;year 2&quot;', '&quot;year 3&quot;'],
       ['&quot;person 1&quot;', '651000', '651000', '651000'],
       ['&quot;person 2&quot;', '1100500', '950100', '340000'],
       ['&quot;person 3&quot;', '740000', '780000', '800000']],
      dtype='|S10')
</code></pre>
<!-- end verbatim block -->
That is, the data in the CSV file are available as an array of
strings.  The code shows how we can easily use slices to extract the
row and column headings, convert the numbers to a floating-point array
for computations, compute the sums, and store various object in the
<code>data</code> dictionary. Then we may write a CSV file as described in the
previous example (see <a href="http://tinyurl.com/pwyasaa/files/rw_csv_numpy2.py" target="_self"><tt>rw_csv_numpy2.py</tt></a>) or we may take a different
approach and extend the <code>arr</code> array with an extra row and fill in the
row heading and the sums (see <a href="http://tinyurl.com/pwyasaa/files/rw_csv_numpy3.py" target="_self"><tt>rw_csv_numpy3.py</tt></a> for the complete code):

<p>
<!-- begin verbatim block  pycod-->
<pre><code>arr = np.genfromtxt('budget.csv', delimiter=',', dtype=str)

# Add row for sum of columns
arr.resize((arr.shape[0]+1, arr.shape[1]))
arr[-1,0] = '&quot;sum&quot;'
subtable = np.asarray(arr[1:-1,1:], dtype=np.float)
sum_row = np.sum(subtable, axis=1)
arr[-1,1:] = np.asarray(sum_row, dtype=str)

# numpy.savetxt writes table with a delimiter between entires
np.savetxt('budget2c.csv', arr, delimiter=',', fmt='%s')
</code></pre>
<!-- end verbatim block -->
Observe how we extract the numbers in <code>subtable</code>, compute with them,
and put the results back into the <code>arr</code> array as strings. The
<code>savetxt</code> function saves a two-dimensional array as a plain table in
a text file, here with
comma as delimiter. The function suffices in this example, none of
the approaches with <code>genfromtxt</code> and <code>savetxt</code> work with
column or row headings containing a comma. Then we need to use the
<code>csv</code> module.

<p>
<p>
<!-- begin bottom navigation -->
<table style="width: 100%"><tr><td>
<div style="text-align: left;"><a href="._files-solarized003.html">&laquo; Previous</a></div>
</td><td>
<div style="text-align: right;"><a href="._files-solarized005.html">Next &raquo;</a></div>
</td></tr></table>
<!-- end bottom navigation -->
</p>

<!-- ------------------- end of main content --------------- -->


</body>
</html>
    

